<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science</title>
  <meta name="description" content="WILD 6900: Computational Tools for Reproducible Science" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="WILD 6900: Computational Tools for Reproducible Science" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science" />
  
  <meta name="twitter:description" content="WILD 6900: Computational Tools for Reproducible Science" />
  

<meta name="author" content="Simona Picardi" />


<meta name="date" content="2021-01-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="relational-databases.html"/>
<link rel="next" href="rsqlite.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Course Material</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#software-requirements-and-installation-instructions"><i class="fa fa-check"></i><b>0.1</b> Software Requirements and Installation Instructions</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#git"><i class="fa fa-check"></i><b>0.1.1</b> Git</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#spreadsheet-editor"><i class="fa fa-check"></i><b>0.1.2</b> Spreadsheet Editor</a></li>
<li class="chapter" data-level="0.1.3" data-path="index.html"><a href="index.html#sqlite"><i class="fa fa-check"></i><b>0.1.3</b> SQLite</a></li>
<li class="chapter" data-level="0.1.4" data-path="index.html"><a href="index.html#r"><i class="fa fa-check"></i><b>0.1.4</b> R</a></li>
<li class="chapter" data-level="0.1.5" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>0.1.5</b> RStudio</a></li>
<li class="chapter" data-level="0.1.6" data-path="index.html"><a href="index.html#required-r-packages"><i class="fa fa-check"></i><b>0.1.6</b> Required R Packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>1</b> Project Organization</a><ul>
<li class="chapter" data-level="1.1" data-path="project-organization.html"><a href="project-organization.html#directory-structure"><i class="fa fa-check"></i><b>1.1</b> Directory structure</a><ul>
<li class="chapter" data-level="1.1.1" data-path="project-organization.html"><a href="project-organization.html#overlap"><i class="fa fa-check"></i><b>1.1.1</b> Overlap</a></li>
<li class="chapter" data-level="1.1.2" data-path="project-organization.html"><a href="project-organization.html#minimizing-duplication"><i class="fa fa-check"></i><b>1.1.2</b> Minimizing duplication</a></li>
<li class="chapter" data-level="1.1.3" data-path="project-organization.html"><a href="project-organization.html#self-containedness"><i class="fa fa-check"></i><b>1.1.3</b> Self-containedness</a></li>
<li class="chapter" data-level="1.1.4" data-path="project-organization.html"><a href="project-organization.html#tradeoffs"><i class="fa fa-check"></i><b>1.1.4</b> Tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="project-organization.html"><a href="project-organization.html#golden-rules"><i class="fa fa-check"></i><b>1.2</b> Golden rules</a></li>
<li class="chapter" data-level="1.3" data-path="project-organization.html"><a href="project-organization.html#be-flexible"><i class="fa fa-check"></i><b>1.3</b> Be flexible</a></li>
<li class="chapter" data-level="1.4" data-path="project-organization.html"><a href="project-organization.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a></li>
<li class="chapter" data-level="1.5" data-path="project-organization.html"><a href="project-organization.html#naming-files"><i class="fa fa-check"></i><b>1.5</b> Naming files</a><ul>
<li class="chapter" data-level="1.5.1" data-path="project-organization.html"><a href="project-organization.html#computer-readable-file-names"><i class="fa fa-check"></i><b>1.5.1</b> Computer-readable file names</a></li>
<li class="chapter" data-level="1.5.2" data-path="project-organization.html"><a href="project-organization.html#human-readable-file-names"><i class="fa fa-check"></i><b>1.5.2</b> Human-readable file names</a></li>
<li class="chapter" data-level="1.5.3" data-path="project-organization.html"><a href="project-organization.html#file-names-that-work-well-with-default-ordering"><i class="fa fa-check"></i><b>1.5.3</b> File names that work well with default ordering</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="project-organization.html"><a href="project-organization.html#rstudio-projects"><i class="fa fa-check"></i><b>1.6</b> RStudio Projects</a></li>
<li class="chapter" data-level="1.7" data-path="project-organization.html"><a href="project-organization.html#relative-and-absolute-paths"><i class="fa fa-check"></i><b>1.7</b> Relative and absolute paths</a><ul>
<li class="chapter" data-level="1.7.1" data-path="project-organization.html"><a href="project-organization.html#path-separators"><i class="fa fa-check"></i><b>1.7.1</b> Path separators</a></li>
<li class="chapter" data-level="1.7.2" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>1.7.2</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="version-control-git.html"><a href="version-control-git.html"><i class="fa fa-check"></i><b>2</b> Version Control with Git</a><ul>
<li class="chapter" data-level="2.1" data-path="version-control-git.html"><a href="version-control-git.html#command-line-basics"><i class="fa fa-check"></i><b>2.1</b> Command line basics</a></li>
<li class="chapter" data-level="2.2" data-path="version-control-git.html"><a href="version-control-git.html#configuring-git"><i class="fa fa-check"></i><b>2.2</b> Configuring Git</a></li>
<li class="chapter" data-level="2.3" data-path="version-control-git.html"><a href="version-control-git.html#getting-help"><i class="fa fa-check"></i><b>2.3</b> Getting help</a></li>
<li class="chapter" data-level="2.4" data-path="version-control-git.html"><a href="version-control-git.html#creating-a-repository"><i class="fa fa-check"></i><b>2.4</b> Creating a repository</a></li>
<li class="chapter" data-level="2.5" data-path="version-control-git.html"><a href="version-control-git.html#tracking-files"><i class="fa fa-check"></i><b>2.5</b> Tracking files</a></li>
<li class="chapter" data-level="2.6" data-path="version-control-git.html"><a href="version-control-git.html#ignoring-files"><i class="fa fa-check"></i><b>2.6</b> Ignoring files</a></li>
<li class="chapter" data-level="2.7" data-path="version-control-git.html"><a href="version-control-git.html#the-3-states"><i class="fa fa-check"></i><b>2.7</b> The 3 states</a></li>
<li class="chapter" data-level="2.8" data-path="version-control-git.html"><a href="version-control-git.html#un-staging-files"><i class="fa fa-check"></i><b>2.8</b> Un-staging files</a></li>
<li class="chapter" data-level="2.9" data-path="version-control-git.html"><a href="version-control-git.html#recovering-a-previous-version-of-a-file"><i class="fa fa-check"></i><b>2.9</b> Recovering a previous version of a file</a></li>
<li class="chapter" data-level="2.10" data-path="version-control-git.html"><a href="version-control-git.html#removing-git"><i class="fa fa-check"></i><b>2.10</b> Removing Git</a></li>
<li class="chapter" data-level="2.11" data-path="version-control-git.html"><a href="version-control-git.html#git-everyday"><i class="fa fa-check"></i><b>2.11</b> Git everyday</a></li>
<li class="chapter" data-level="2.12" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>2.12</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>3</b> Collaborative Science with GitHub</a><ul>
<li class="chapter" data-level="3.1" data-path="github.html"><a href="github.html#adding-a-remote-to-a-local-repository"><i class="fa fa-check"></i><b>3.1</b> Adding a remote to a local repository</a></li>
<li class="chapter" data-level="3.2" data-path="github.html"><a href="github.html#pushing-to-a-remote-repository"><i class="fa fa-check"></i><b>3.2</b> Pushing to a remote repository</a></li>
<li class="chapter" data-level="3.3" data-path="github.html"><a href="github.html#cloning-a-repository"><i class="fa fa-check"></i><b>3.3</b> Cloning a repository</a></li>
<li class="chapter" data-level="3.4" data-path="github.html"><a href="github.html#synchronizing-changes-among-collaborators"><i class="fa fa-check"></i><b>3.4</b> Synchronizing changes among collaborators</a></li>
<li class="chapter" data-level="3.5" data-path="github.html"><a href="github.html#resolving-conflicts"><i class="fa fa-check"></i><b>3.5</b> Resolving conflicts</a></li>
<li class="chapter" data-level="3.6" data-path="github.html"><a href="github.html#avoiding-conflicts"><i class="fa fa-check"></i><b>3.6</b> Avoiding conflicts</a></li>
<li class="chapter" data-level="3.7" data-path="github.html"><a href="github.html#working-with-branches"><i class="fa fa-check"></i><b>3.7</b> Working with branches</a></li>
<li class="chapter" data-level="3.8" data-path="github.html"><a href="github.html#forking-a-repository"><i class="fa fa-check"></i><b>3.8</b> Forking a repository</a></li>
<li class="chapter" data-level="3.9" data-path="github.html"><a href="github.html#pull-requests"><i class="fa fa-check"></i><b>3.9</b> Pull requests</a></li>
<li class="chapter" data-level="3.10" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>3.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spreadsheets.html"><a href="spreadsheets.html"><i class="fa fa-check"></i><b>4</b> Best Practices in the Use of Spreadsheets</a><ul>
<li class="chapter" data-level="4.1" data-path="spreadsheets.html"><a href="spreadsheets.html#what-are-spreadsheets-good-for"><i class="fa fa-check"></i><b>4.1</b> What are spreadsheets good for?</a></li>
<li class="chapter" data-level="4.2" data-path="spreadsheets.html"><a href="spreadsheets.html#human-readable-vs.-computer-readable-data"><i class="fa fa-check"></i><b>4.2</b> Human-readable vs. computer-readable data</a></li>
<li class="chapter" data-level="4.3" data-path="spreadsheets.html"><a href="spreadsheets.html#tidydata"><i class="fa fa-check"></i><b>4.3</b> Tidy data</a></li>
<li class="chapter" data-level="4.4" data-path="spreadsheets.html"><a href="spreadsheets.html#problematic-practices"><i class="fa fa-check"></i><b>4.4</b> Problematic practices</a><ul>
<li class="chapter" data-level="4.4.1" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-variables-in-a-single-column"><i class="fa fa-check"></i><b>4.4.1</b> Multiple variables in a single column</a></li>
<li class="chapter" data-level="4.4.2" data-path="spreadsheets.html"><a href="spreadsheets.html#rows-for-variables-columns-for-observation"><i class="fa fa-check"></i><b>4.4.2</b> Rows for variables, columns for observation</a></li>
<li class="chapter" data-level="4.4.3" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-tables-in-a-single-spreadsheet"><i class="fa fa-check"></i><b>4.4.3</b> Multiple tables in a single spreadsheet</a></li>
<li class="chapter" data-level="4.4.4" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-sheets"><i class="fa fa-check"></i><b>4.4.4</b> Multiple sheets</a></li>
<li class="chapter" data-level="4.4.5" data-path="spreadsheets.html"><a href="spreadsheets.html#using-formatting-to-convey-information"><i class="fa fa-check"></i><b>4.4.5</b> Using formatting to convey information</a></li>
<li class="chapter" data-level="4.4.6" data-path="spreadsheets.html"><a href="spreadsheets.html#putting-units-in-cells"><i class="fa fa-check"></i><b>4.4.6</b> Putting units in cells</a></li>
<li class="chapter" data-level="4.4.7" data-path="spreadsheets.html"><a href="spreadsheets.html#using-problematic-column-names"><i class="fa fa-check"></i><b>4.4.7</b> Using problematic column names</a></li>
<li class="chapter" data-level="4.4.8" data-path="spreadsheets.html"><a href="spreadsheets.html#conflating-zeros-and-missing-values"><i class="fa fa-check"></i><b>4.4.8</b> Conflating zeros and missing values</a></li>
<li class="chapter" data-level="4.4.9" data-path="spreadsheets.html"><a href="spreadsheets.html#using-problematic-null-values"><i class="fa fa-check"></i><b>4.4.9</b> Using problematic null values</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spreadsheets.html"><a href="spreadsheets.html#document-document-document"><i class="fa fa-check"></i><b>4.5</b> Document, document, document!</a></li>
<li class="chapter" data-level="4.6" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>4.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="relational-databases.html"><a href="relational-databases.html"><i class="fa fa-check"></i><b>5</b> Relational Databases</a><ul>
<li class="chapter" data-level="5.1" data-path="relational-databases.html"><a href="relational-databases.html#what-is-a-relational-database"><i class="fa fa-check"></i><b>5.1</b> What is a relational database?</a></li>
<li class="chapter" data-level="5.2" data-path="relational-databases.html"><a href="relational-databases.html#why-bothering-with-relational-databases"><i class="fa fa-check"></i><b>5.2</b> Why bothering with relational databases?</a></li>
<li class="chapter" data-level="5.3" data-path="relational-databases.html"><a href="relational-databases.html#database-components"><i class="fa fa-check"></i><b>5.3</b> Database components</a></li>
<li class="chapter" data-level="5.4" data-path="relational-databases.html"><a href="relational-databases.html#database-design-and-architecture"><i class="fa fa-check"></i><b>5.4</b> Database design and architecture</a></li>
<li class="chapter" data-level="5.5" data-path="relational-databases.html"><a href="relational-databases.html#data-types"><i class="fa fa-check"></i><b>5.5</b> Data types</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>6</b> Basics of SQL Language</a><ul>
<li class="chapter" data-level="6.1" data-path="sql.html"><a href="sql.html#building-a-database"><i class="fa fa-check"></i><b>6.1</b> Building a database</a><ul>
<li class="chapter" data-level="6.1.1" data-path="sql.html"><a href="sql.html#creating-a-new-database-in-sqlite-studio"><i class="fa fa-check"></i><b>6.1.1</b> Creating a new database in SQLite Studio</a></li>
<li class="chapter" data-level="6.1.2" data-path="sql.html"><a href="sql.html#creating-tables"><i class="fa fa-check"></i><b>6.1.2</b> Creating tables</a></li>
<li class="chapter" data-level="6.1.3" data-path="sql.html"><a href="sql.html#adding-constraints"><i class="fa fa-check"></i><b>6.1.3</b> Adding constraints</a></li>
<li class="chapter" data-level="6.1.4" data-path="sql.html"><a href="sql.html#order-of-table-creation"><i class="fa fa-check"></i><b>6.1.4</b> Order of table creation</a></li>
<li class="chapter" data-level="6.1.5" data-path="sql.html"><a href="sql.html#populating-the-tables"><i class="fa fa-check"></i><b>6.1.5</b> Populating the tables</a></li>
<li class="chapter" data-level="6.1.6" data-path="sql.html"><a href="sql.html#autoincrements-as-primary-keys"><i class="fa fa-check"></i><b>6.1.6</b> Autoincrements as primary keys</a></li>
<li class="chapter" data-level="6.1.7" data-path="sql.html"><a href="sql.html#foreign-keys"><i class="fa fa-check"></i><b>6.1.7</b> Foreign keys</a></li>
<li class="chapter" data-level="6.1.8" data-path="sql.html"><a href="sql.html#crossing-existing-information-to-derive-new-tables"><i class="fa fa-check"></i><b>6.1.8</b> Crossing existing information to derive new tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rsqlite.html"><a href="rsqlite.html"><i class="fa fa-check"></i><b>7</b> Linking Databases and R with RSQLite</a></li>
<li class="chapter" data-level="8" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>8</b> Dynamic Documents with RMarkdown</a></li>
<li class="chapter" data-level="9" data-path="github-pages.html"><a href="github-pages.html"><i class="fa fa-check"></i><b>9</b> Automatically Generated Websites with GitHub Pages</a><ul>
<li class="chapter" data-level="9.1" data-path="github-pages.html"><a href="github-pages.html#bookdown"><i class="fa fa-check"></i><b>9.1</b> Bookdown</a><ul>
<li class="chapter" data-level="9.1.1" data-path="github-pages.html"><a href="github-pages.html#creating-a-book"><i class="fa fa-check"></i><b>9.1.1</b> Creating a book</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="github-pages.html"><a href="github-pages.html#publishing-a-book-with-github-pages"><i class="fa fa-check"></i><b>9.2</b> Publishing a book with GitHub Pages</a><ul>
<li class="chapter" data-level="9.2.1" data-path="github-pages.html"><a href="github-pages.html#step-1-set-up-compatibility-with-github-pages"><i class="fa fa-check"></i><b>9.2.1</b> Step 1: Set up compatibility with GitHub Pages</a></li>
<li class="chapter" data-level="9.2.2" data-path="github-pages.html"><a href="github-pages.html#step-2-set-up-git-repository"><i class="fa fa-check"></i><b>9.2.2</b> Step 2: Set up Git repository</a></li>
<li class="chapter" data-level="9.2.3" data-path="github-pages.html"><a href="github-pages.html#step-3-link-git-repository-to-remote-github-repository"><i class="fa fa-check"></i><b>9.2.3</b> Step 3: Link Git repository to remote GitHub repository</a></li>
<li class="chapter" data-level="9.2.4" data-path="github-pages.html"><a href="github-pages.html#step-4-enable-github-pages"><i class="fa fa-check"></i><b>9.2.4</b> Step 4: Enable GitHub Pages</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="github-pages.html"><a href="github-pages.html#maintaining-the-website"><i class="fa fa-check"></i><b>9.3</b> Maintaining the website</a></li>
<li class="chapter" data-level="9.4" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>9.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>10</b> Introduction to R</a></li>
<li class="chapter" data-level="11" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>11</b> Troubleshooting in R</a></li>
<li class="chapter" data-level="12" data-path="renv.html"><a href="renv.html"><i class="fa fa-check"></i><b>12</b> Working Environments in R</a></li>
<li class="chapter" data-level="13" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>13</b> Data Wrangling with tidyverse</a></li>
<li class="chapter" data-level="14" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>14</b> Data Visualization with ggplot2</a></li>
<li class="chapter" data-level="15" data-path="geospatial.html"><a href="geospatial.html"><i class="fa fa-check"></i><b>15</b> Introduction to Geospatial Data in R</a></li>
<li class="chapter" data-level="16" data-path="problem-decomposition.html"><a href="problem-decomposition.html"><i class="fa fa-check"></i><b>16</b> Problem Decomposition</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Tools for Reproducible Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sql" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Basics of SQL Language</h1>
<p>Basic queries, aggregations, aliases,</p>
<p>Joins</p>
<div id="building-a-database" class="section level2">
<h2><span class="header-section-number">6.1</span> Building a database</h2>
<div id="creating-a-new-database-in-sqlite-studio" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Creating a new database in SQLite Studio</h3>
<p>We are now going to see how to build a database by recreating the dragons
database we have been practicing on. Let’s open up SQLite Studio and, on the
<em>Database</em> tab, click “Add a database” (or use Ctrl/Cmd + O as a shortcut).
Click on the green plus sign, navigate to the folder where you want to save the
database, and choose a file name. Click “Save”. Now we need to also choose a
name to use internally (this name will appear in the drop-down list of databases
within SQLite, but it does not necessarily need to be the same as the filename.)
Click “OK” and you should see your new database in the list on the left.</p>
</div>
<div id="creating-tables" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Creating tables</h3>
<p>Now let’s open the SQL editor (<em>Tools</em> &gt; <em>SQL editor</em>). Double check that you
are working on the correct database (the name of the active database is shown
in the toolbar). We are ready to create our first table!</p>
<p>To create a table, we need to specify a name for the table, as well as a name
and a data type for each column. The basic format is as follows:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb47-1"><a href="sql.html#cb47-1"></a></span>
<span id="cb47-2"><a href="sql.html#cb47-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table_name (</span>
<span id="cb47-3"><a href="sql.html#cb47-3"></a>column_1 data_type,</span>
<span id="cb47-4"><a href="sql.html#cb47-4"></a>column_2 data_type,</span>
<span id="cb47-5"><a href="sql.html#cb47-5"></a>column_3 data_type,</span>
<span id="cb47-6"><a href="sql.html#cb47-6"></a><span class="op">..</span>.</span>
<span id="cb47-7"><a href="sql.html#cb47-7"></a>)</span></code></pre></div>
<p>Let’s start by creating the dragons table. Remember that each table needs to
have a primary key, i.e., a column that serves as the unique identifier of each
row. The values in this column need to be unique and cannot be null. In this
table, we can use the dragon ID as the primary key:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb48-1"><a href="sql.html#cb48-1"></a></span>
<span id="cb48-2"><a href="sql.html#cb48-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> dragons (</span>
<span id="cb48-3"><a href="sql.html#cb48-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb48-4"><a href="sql.html#cb48-4"></a>sex <span class="dt">char</span>(<span class="dv">1</span>),</span>
<span id="cb48-5"><a href="sql.html#cb48-5"></a>age_class <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb48-6"><a href="sql.html#cb48-6"></a>species <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb48-7"><a href="sql.html#cb48-7"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span> (dragon_id)</span>
<span id="cb48-8"><a href="sql.html#cb48-8"></a>);</span></code></pre></div>
<p>Notice that I specified a number of digits for each character variable. Because
the format of the dragon ID is “D” + number from 1 up to 500 (for now), setting
the ID as a character string with varying size up to 5 digits allows for IDs
from “D1” to “D9999”. So far, we only have 500 individuals, so strictly it would
have been enough to set the limit to 4 digits only, but it’s good to have some
forethought and allow for growth into the future. At the same time, it seems
reasonable to assume we won’t catch 10 thousand dragons in this project, so 5
digits is a good compromise. In reality, space is rarely limiting to the
point where 4 or 10 digits makes a difference, so when in doubt err on the side
of more room for growth.</p>
<p>While dragon ID, age class, and species have a variable number of digits, sex
always has one (it can be “M” or “F”). So we can make this a <code>char</code> instead of
a <code>varchar</code> and specify it will have 1 digit.</p>
</div>
<div id="adding-constraints" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Adding constraints</h3>
<p>We can also add some constraints for the purpose of quality assurance. For
example, because the dragon ID is the primary key, we can’t accept null values
in this column. Sex is always one of “M” or “F” and age is always one of
“Juvenile”, “Subadult”, or “Adult”. In other SQL dialects you can add these
after the fact, but in SQLite the only way to add these constraints is at the
same time as you create the table. We can delete the table and re-create it by
modifying the above syntax as follows:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb49-1"><a href="sql.html#cb49-1"></a></span>
<span id="cb49-2"><a href="sql.html#cb49-2"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> dragons;</span>
<span id="cb49-3"><a href="sql.html#cb49-3"></a></span>
<span id="cb49-4"><a href="sql.html#cb49-4"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> dragons (</span>
<span id="cb49-5"><a href="sql.html#cb49-5"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb49-6"><a href="sql.html#cb49-6"></a>sex <span class="dt">char</span>(<span class="dv">1</span>) <span class="kw">CHECK</span> (sex <span class="kw">IN</span> (<span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>)),</span>
<span id="cb49-7"><a href="sql.html#cb49-7"></a>age_class <span class="dt">varchar</span>(<span class="dv">8</span>) <span class="kw">CHECK</span> (age_class <span class="kw">IN</span> (<span class="st">&#39;Juvenile&#39;</span>, <span class="st">&#39;Subadult&#39;</span>, <span class="st">&#39;Adult&#39;</span>)),</span>
<span id="cb49-8"><a href="sql.html#cb49-8"></a>species <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb49-9"><a href="sql.html#cb49-9"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span> (dragon_id)</span>
<span id="cb49-10"><a href="sql.html#cb49-10"></a>);</span></code></pre></div>
</div>
<div id="order-of-table-creation" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Order of table creation</h3>
<p>Foreign keys are also specified as constraints. Because it’s not possible to
enforce constraints as an afterthought, we need to plan the order in which we
add tables carefully. If we try to add a foreign key that refers to a table that
doesn’t exist yet, we won’t be able to. Let’s take another look at the diagram
of our table relationships:</p>
<p>img</p>
<p>Any table that has one or more foreign keys needs to be added <em>after</em> the
related table/s. In our case, there are three “root” tables that do not have
any foreign keys: the dragons table, the tags table, and the capture sites
table. We can add these three first and then all the others.</p>
<p>The tags table has a <code>tag_id</code> field which is unique and can therefore be used as
a primary key. Note that when you make a column the primary key you automatically
enforce a unique constraint on that column. However, SQLite does not enforce a
not-null constraint on primary keys like most other SQL dialects. Because SQLite
doesn’t, we have to do it ourselves:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb50-1"><a href="sql.html#cb50-1"></a></span>
<span id="cb50-2"><a href="sql.html#cb50-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> tags (</span>
<span id="cb50-3"><a href="sql.html#cb50-3"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb50-4"><a href="sql.html#cb50-4"></a>brand <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb50-5"><a href="sql.html#cb50-5"></a>status <span class="dt">varchar</span>(<span class="dv">20</span>)</span>
<span id="cb50-6"><a href="sql.html#cb50-6"></a>);</span></code></pre></div>
<p>The capture sites table has a <code>site</code> field which contains a 3-letter code that
uniquely identifies the site. We can use that as a primary key. The UTM
coordinates are numeric values for which we can use the data type called “double
precision”, or just “double”. There are several possible choices for numeric
data types. “Double precision” and “float” are both suitable data types for
storing real numbers, but double precision stores numeric values
with higher precision than float. Both of these allow for variable decimal
places, whereas the data type “decimal” enforces the same number of decimal
places across records. The choice between these data types depends on 1. whether
we want the measurements to all have the same number of decimal places or not,
and 2. how many significant digits do we expect/care about. Double precision can
store up to 15 significant digits (unlike float which can store up to 8), but it
also occupies double the space (64 bit instead of 32.) For UTM coordinates, the
Y value has a minimum of 7 digits, and we want to keep decimal places because
we need the highest precision possible on the position of animals in space.
Therefore, we’ll go with double precision:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb51-1"><a href="sql.html#cb51-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> capture_sites (</span>
<span id="cb51-2"><a href="sql.html#cb51-2"></a>site <span class="dt">char</span>(<span class="dv">3</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb51-3"><a href="sql.html#cb51-3"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb51-4"><a href="sql.html#cb51-4"></a>utm_y <span class="dt">double</span></span>
<span id="cb51-5"><a href="sql.html#cb51-5"></a>);</span></code></pre></div>
<p>Note that I used an alternative syntax to specify the primary key.
This is equivalent to the one I used above for the dragons table.</p>
</div>
<div id="populating-the-tables" class="section level3">
<h3><span class="header-section-number">6.1.5</span> Populating the tables</h3>
<p>Now that we added a few tables, we can start to populate the database by loading
the data as .csv files. On the <em>Tools</em> tab, click “Import.”</p>
<p>img</p>
<p>Check that the database is correct and then select the table you want to import
data into. For example, let’s start with the dragons table:</p>
<p>img</p>
<p>Click <em>Next</em>. Now, browse your directory to select the input file. Then check
the box that says “First line represents CSV column names”, make sure the field
separator is a comma, and set the <em>NULL</em> values to <code>NA</code> (which is how they are
encoded in the .csv.) Click <em>Finish</em>.</p>
<p>To check if the table was imported correctly, go back into the query editor and
try to look at the first 10 rows:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb52-1"><a href="sql.html#cb52-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> dragons <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>If everything looks good, we can go ahead and import data in the other two
tables.</p>
</div>
<div id="autoincrements-as-primary-keys" class="section level3">
<h3><span class="header-section-number">6.1.6</span> Autoincrements as primary keys</h3>
<p>Sometimes a table does not contain any columns with unique values. This is the
case for all the tables we have left to add. What do we use as primary key in
these situations? Adding a column with a serial number that gets automatically
updated is a good option. SQLite has something called auto-increment, which is
an integer column that automatically increases by 1 each time you add a row to
a table. Because it’s incremental, the values of an auto-increment will always
be unique, and because it’s automatic, they will never be null. Sounds like a
perfect candidate for a primary key.</p>
<p>The problem with using an auto-increment as a primary key arises when you’re
trying to import data from a .csv file. If the column with the auto-increment
does not already exist in the .csv, SQLite won’t let you import the file into
the table because the number of columns does not match. We don’t want to add the
auto-increment into the .csv ourselves because that defeats the purpose of
having SQLite doing it for us. But if we import the .csv as it is (without
primary key) and then add the auto-increment column later, we won’t be able to
make it the primary key because SQLite won’t let us. So, what do we do?</p>
<p>One workaround that people have found to solve this issue is to trick SQLite by
using a temporary table. This is how the process works:</p>
<ol style="list-style-type: decimal">
<li>Create the table the way we want it, with an auto-increment primary key plus
all the columns we want to import from the .csv;</li>
<li>Create a temporary table without primary key that only contains the columns
from the .csv;</li>
<li>Import the .csv into the temporary table;</li>
<li>Populate the final table by pulling data from the temporary table;</li>
<li>Delete the temporary table.</li>
</ol>
<p>A little convoluted, but it does the job. Let’s demonstrate this on the captures
table. First, we create the table like we want it to look in the end (note that
I am adding foreign keys; we’ll go over that part in the next section):</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb53-1"><a href="sql.html#cb53-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> captures (</span>
<span id="cb53-2"><a href="sql.html#cb53-2"></a>capture_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb53-3"><a href="sql.html#cb53-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb53-4"><a href="sql.html#cb53-4"></a><span class="dt">date</span> text,</span>
<span id="cb53-5"><a href="sql.html#cb53-5"></a>site <span class="dt">char</span>(<span class="dv">3</span>),</span>
<span id="cb53-6"><a href="sql.html#cb53-6"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb53-7"><a href="sql.html#cb53-7"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(site) <span class="kw">REFERENCES</span> capture_sites(site)</span>
<span id="cb53-8"><a href="sql.html#cb53-8"></a>);</span></code></pre></div>
<p>Second, we create a temporary table without the primary key (no need to add
foreign keys to this one as we are going to delete it anyway):</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb54-1"><a href="sql.html#cb54-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> captures_temp (</span>
<span id="cb54-2"><a href="sql.html#cb54-2"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb54-3"><a href="sql.html#cb54-3"></a><span class="dt">date</span> text,</span>
<span id="cb54-4"><a href="sql.html#cb54-4"></a>site <span class="dt">char</span>(<span class="dv">3</span>));</span></code></pre></div>
<p>Now on <em>Tools</em> &gt; <em>Import</em>, we upload <code>captures.csv</code> into <code>captures_temp</code>. Then
we can populate the final table as follows:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="sql.html#cb55-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> captures(dragon_id, <span class="dt">date</span>, site) <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> captures_temp;</span></code></pre></div>
<p>And finally we delete our temporary table:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="sql.html#cb56-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> captures_temp;</span></code></pre></div>
<p>We better get familiar with this workflow because we are going to use it for all
the other tables now.</p>
</div>
<div id="foreign-keys" class="section level3">
<h3><span class="header-section-number">6.1.7</span> Foreign keys</h3>
<p>For each of the remaining tables, we will specify one or more foreign keys to
enforce the relationships between tables. Each foreign key is the primary key of
another table. See for example what we did above: the captures table we just
imported contains information on when and where each dragon was captured. This
means this table needs to have two foreign keys: the <code>dragon_id</code> column links it
to the dragons table and the <code>site</code> column links it to the capture sites table.
Now let’s apply the concept to the other tables.</p>
<p>The morphometrics table will have a single foreign key linking it to the dragons
table (the dragon ID). The second column is a date – SQLite does not have a
dedicated data type for dates. Instead, we stored this as a character string in
ISO8601 format (“YYYY-MM-DD HH:MM:SS.SSS”). This time there is no need for
double precision because we want to only retain up to the third decimal place
and the numbers are not larger than ~3000, so 8 significant digits is sufficient.
We’ll use float as the data type for the measurements. Because individuals may
have been measured multiple times, none of the existing columns are unique. This
means we’ll create a serial number to use as the primary key. We’ll use the same
trick as above:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="sql.html#cb57-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> morphometrics (</span>
<span id="cb57-2"><a href="sql.html#cb57-2"></a>measurement_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb57-3"><a href="sql.html#cb57-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb57-4"><a href="sql.html#cb57-4"></a><span class="dt">date</span> text,</span>
<span id="cb57-5"><a href="sql.html#cb57-5"></a>total_body_length_cm <span class="dt">float</span>,</span>
<span id="cb57-6"><a href="sql.html#cb57-6"></a>wingspan_cm <span class="dt">float</span>,</span>
<span id="cb57-7"><a href="sql.html#cb57-7"></a>tail_length_cm <span class="dt">float</span>,</span>
<span id="cb57-8"><a href="sql.html#cb57-8"></a>tarsus_length_cm <span class="dt">float</span>,</span>
<span id="cb57-9"><a href="sql.html#cb57-9"></a>claw_length_cm <span class="dt">float</span>,</span>
<span id="cb57-10"><a href="sql.html#cb57-10"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb57-11"><a href="sql.html#cb57-11"></a>);</span>
<span id="cb57-12"><a href="sql.html#cb57-12"></a></span>
<span id="cb57-13"><a href="sql.html#cb57-13"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> morphometrics_temp (</span>
<span id="cb57-14"><a href="sql.html#cb57-14"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb57-15"><a href="sql.html#cb57-15"></a><span class="dt">date</span> text,</span>
<span id="cb57-16"><a href="sql.html#cb57-16"></a>total_body_length_cm <span class="dt">float</span>,</span>
<span id="cb57-17"><a href="sql.html#cb57-17"></a>wingspan_cm <span class="dt">float</span>,</span>
<span id="cb57-18"><a href="sql.html#cb57-18"></a>tail_length_cm <span class="dt">float</span>,</span>
<span id="cb57-19"><a href="sql.html#cb57-19"></a>tarsus_length_cm <span class="dt">float</span>,</span>
<span id="cb57-20"><a href="sql.html#cb57-20"></a>claw_length_cm <span class="dt">float</span></span>
<span id="cb57-21"><a href="sql.html#cb57-21"></a>);</span></code></pre></div>
<p>Now on <em>Tools</em> &gt; <em>Import</em>, we upload <code>morphometrics.csv</code> into
<code>morphometrics_temp</code>. Then we populate the final table:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb58-1"><a href="sql.html#cb58-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> morphometrics(dragon_id, <span class="dt">date</span>, total_body_length_cm, wingspan_cm,</span>
<span id="cb58-2"><a href="sql.html#cb58-2"></a>tail_length_cm, tarsus_length_cm, claw_length_cm) </span>
<span id="cb58-3"><a href="sql.html#cb58-3"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> morphometrics_temp;</span></code></pre></div>
<p>And delete our temporary table:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb59-1"><a href="sql.html#cb59-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> morphometrics_temp;</span></code></pre></div>
<p>The diet table contains repeated sample IDs and repeated item IDs within each
sample. We’ll need a serial number here too because none of the columns are
unique. The item ID is an integer so we are going to use a new numeric data type
for it. The foreign key will be, again, the dragon ID referring to the dragons
table:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb60-1"><a href="sql.html#cb60-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> diet (</span>
<span id="cb60-2"><a href="sql.html#cb60-2"></a>diet_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb60-3"><a href="sql.html#cb60-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb60-4"><a href="sql.html#cb60-4"></a>sample_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb60-5"><a href="sql.html#cb60-5"></a><span class="dt">date</span> text,</span>
<span id="cb60-6"><a href="sql.html#cb60-6"></a>item_id <span class="dt">integer</span>,</span>
<span id="cb60-7"><a href="sql.html#cb60-7"></a>item <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb60-8"><a href="sql.html#cb60-8"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb60-9"><a href="sql.html#cb60-9"></a>);</span>
<span id="cb60-10"><a href="sql.html#cb60-10"></a></span>
<span id="cb60-11"><a href="sql.html#cb60-11"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> diet_temp (</span>
<span id="cb60-12"><a href="sql.html#cb60-12"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb60-13"><a href="sql.html#cb60-13"></a>sample_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb60-14"><a href="sql.html#cb60-14"></a><span class="dt">date</span> text,</span>
<span id="cb60-15"><a href="sql.html#cb60-15"></a>item_id <span class="dt">integer</span>,</span>
<span id="cb60-16"><a href="sql.html#cb60-16"></a>item <span class="dt">varchar</span>(<span class="dv">50</span>)</span>
<span id="cb60-17"><a href="sql.html#cb60-17"></a>);</span></code></pre></div>
<p>Upload <code>diet.csv</code> into <code>diet_temp</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb61-1"><a href="sql.html#cb61-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> diet(dragon_id, sample_id, <span class="dt">date</span>, item_id, item) </span>
<span id="cb61-2"><a href="sql.html#cb61-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> diet_temp;</span>
<span id="cb61-3"><a href="sql.html#cb61-3"></a></span>
<span id="cb61-4"><a href="sql.html#cb61-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> diet_temp;</span></code></pre></div>
<p>The deployments table assigns a tag to each individual within a certain period
of time. The <code>dragon_id</code> column will be the foreign key that links it to the
dragons table, and the <code>tag_id</code> column will link it to the tags table. The start
and end deployment dates will be stored as ISO8601 text. Again, we’ll need a
serial number to use as a primary key:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb62-1"><a href="sql.html#cb62-1"></a></span>
<span id="cb62-2"><a href="sql.html#cb62-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> deployments (</span>
<span id="cb62-3"><a href="sql.html#cb62-3"></a>deployment_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb62-4"><a href="sql.html#cb62-4"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb62-5"><a href="sql.html#cb62-5"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb62-6"><a href="sql.html#cb62-6"></a>start_deployment text,</span>
<span id="cb62-7"><a href="sql.html#cb62-7"></a>end_deployment text,</span>
<span id="cb62-8"><a href="sql.html#cb62-8"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb62-9"><a href="sql.html#cb62-9"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb62-10"><a href="sql.html#cb62-10"></a>);</span>
<span id="cb62-11"><a href="sql.html#cb62-11"></a></span>
<span id="cb62-12"><a href="sql.html#cb62-12"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> deployments_temp (</span>
<span id="cb62-13"><a href="sql.html#cb62-13"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb62-14"><a href="sql.html#cb62-14"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb62-15"><a href="sql.html#cb62-15"></a>start_deployment text,</span>
<span id="cb62-16"><a href="sql.html#cb62-16"></a>end_deployment text</span>
<span id="cb62-17"><a href="sql.html#cb62-17"></a>);</span></code></pre></div>
<p>Upload <code>deployments.csv</code> into <code>deployments_temp</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb63-1"><a href="sql.html#cb63-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> deployments(dragon_id, tag_id, start_deployment, end_deployment) </span>
<span id="cb63-2"><a href="sql.html#cb63-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> deployments_temp;</span>
<span id="cb63-3"><a href="sql.html#cb63-3"></a></span>
<span id="cb63-4"><a href="sql.html#cb63-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> deployments_temp;</span></code></pre></div>
<p>Now we can input the telemetry data. This table contains the raw tracking data
as we download it from the tags. We’ll need a serial number to uniquely identify
each record, and we’ll add the tag ID as the foreign key to the tags table:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb64-1"><a href="sql.html#cb64-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data_raw (</span>
<span id="cb64-2"><a href="sql.html#cb64-2"></a>gps_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb64-3"><a href="sql.html#cb64-3"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb64-4"><a href="sql.html#cb64-4"></a><span class="dt">timestamp</span> text, </span>
<span id="cb64-5"><a href="sql.html#cb64-5"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb64-6"><a href="sql.html#cb64-6"></a>utm_y <span class="dt">double</span>,</span>
<span id="cb64-7"><a href="sql.html#cb64-7"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb64-8"><a href="sql.html#cb64-8"></a>);</span>
<span id="cb64-9"><a href="sql.html#cb64-9"></a></span>
<span id="cb64-10"><a href="sql.html#cb64-10"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data_raw_temp (</span>
<span id="cb64-11"><a href="sql.html#cb64-11"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb64-12"><a href="sql.html#cb64-12"></a><span class="dt">timestamp</span> text, </span>
<span id="cb64-13"><a href="sql.html#cb64-13"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb64-14"><a href="sql.html#cb64-14"></a>utm_y <span class="dt">double</span></span>
<span id="cb64-15"><a href="sql.html#cb64-15"></a>);</span></code></pre></div>
<p>Upload <code>telemetry_raw.csv</code> into <code>gps_data_raw_temp</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb65-1"><a href="sql.html#cb65-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> gps_data_raw(tag_id, <span class="dt">timestamp</span>, utm_x, utm_y) </span>
<span id="cb65-2"><a href="sql.html#cb65-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gps_data_raw_temp;</span>
<span id="cb65-3"><a href="sql.html#cb65-3"></a></span>
<span id="cb65-4"><a href="sql.html#cb65-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> gps_data_raw_temp;</span></code></pre></div>
</div>
<div id="crossing-existing-information-to-derive-new-tables" class="section level3">
<h3><span class="header-section-number">6.1.8</span> Crossing existing information to derive new tables</h3>
<p>The raw GPS data table does not give us any information about which animal each
location corresponds to; all we know is the tag ID. Each tag does not correspond
to an individual, because some tags are reused on multiple dragons. So how do
we make these data usable? How do we know who is who? To associate each location
to the correct animal, we need to know who was wearing the tag at the time that
location was taken. There is a very elegant solution to our problem, as we can
pull the range of dates an individual was wearing a certain tag from the
deployments table, cross those dates with the dates in the raw GPS data, and
create an updated telemetry table where each location is assigned to the correct
individual. No manual work involved. Are you ready for some magic?! First, we
create the table structure:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb66-1"><a href="sql.html#cb66-1"></a></span>
<span id="cb66-2"><a href="sql.html#cb66-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data (</span>
<span id="cb66-3"><a href="sql.html#cb66-3"></a>loc_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb66-4"><a href="sql.html#cb66-4"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb66-5"><a href="sql.html#cb66-5"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb66-6"><a href="sql.html#cb66-6"></a><span class="dt">timestamp</span> text,</span>
<span id="cb66-7"><a href="sql.html#cb66-7"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb66-8"><a href="sql.html#cb66-8"></a>utm_y <span class="dt">double</span>,</span>
<span id="cb66-9"><a href="sql.html#cb66-9"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb66-10"><a href="sql.html#cb66-10"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb66-11"><a href="sql.html#cb66-11"></a>);</span></code></pre></div>
<p>And then we populate it by pulling information from the raw GPS and deployment
tables. Locations are assigned to the individual that was wearing the tag at the
time based on the <code>WHERE</code> clause:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb67-1"><a href="sql.html#cb67-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> gps_data (</span>
<span id="cb67-2"><a href="sql.html#cb67-2"></a>tag_id, dragon_id, <span class="dt">timestamp</span>, utm_x, utm_y)</span>
<span id="cb67-3"><a href="sql.html#cb67-3"></a><span class="kw">SELECT</span></span>
<span id="cb67-4"><a href="sql.html#cb67-4"></a>deployments.tag_id,</span>
<span id="cb67-5"><a href="sql.html#cb67-5"></a>deployments.dragon_id,</span>
<span id="cb67-6"><a href="sql.html#cb67-6"></a>gps_data_raw.<span class="dt">timestamp</span>,</span>
<span id="cb67-7"><a href="sql.html#cb67-7"></a>gps_data_raw.utm_x,</span>
<span id="cb67-8"><a href="sql.html#cb67-8"></a>gps_data_raw.utm_y</span>
<span id="cb67-9"><a href="sql.html#cb67-9"></a><span class="kw">FROM</span> deployments <span class="kw">LEFT</span> <span class="kw">JOIN</span> gps_data_raw <span class="kw">USING</span> (tag_id)</span>
<span id="cb67-10"><a href="sql.html#cb67-10"></a><span class="kw">WHERE</span> gps_data_raw.tag_id <span class="op">=</span> deployments.tag_id <span class="kw">AND</span></span>
<span id="cb67-11"><a href="sql.html#cb67-11"></a>(</span>
<span id="cb67-12"><a href="sql.html#cb67-12"></a>    (</span>
<span id="cb67-13"><a href="sql.html#cb67-13"></a>    (strftime(gps_data_raw.<span class="dt">timestamp</span>) <span class="op">&gt;=</span> strftime(deployments.start_deployment)) <span class="kw">AND</span></span>
<span id="cb67-14"><a href="sql.html#cb67-14"></a>    (strftime(gps_data_raw.<span class="dt">timestamp</span>) <span class="op">&lt;=</span> strftime(deployments.end_deployment))</span>
<span id="cb67-15"><a href="sql.html#cb67-15"></a>    )</span>
<span id="cb67-16"><a href="sql.html#cb67-16"></a><span class="kw">OR</span> </span>
<span id="cb67-17"><a href="sql.html#cb67-17"></a>    (</span>
<span id="cb67-18"><a href="sql.html#cb67-18"></a>    (gps_data_raw.<span class="dt">timestamp</span> <span class="op">&gt;=</span> deployments.start_deployment) <span class="kw">AND</span></span>
<span id="cb67-19"><a href="sql.html#cb67-19"></a>    (deployments.end_deployment <span class="kw">IS</span> <span class="kw">NULL</span>)</span>
<span id="cb67-20"><a href="sql.html#cb67-20"></a>    )</span>
<span id="cb67-21"><a href="sql.html#cb67-21"></a>);</span></code></pre></div>
<p>Note that, because we populated this table with data from other existing tables,
we ended up using <code>INSERT INTO</code> anyway and there was no need to use our trick
with a temporary table.</p>
<p>It should now be apparent that keeping the deployments table correctly filled
out with no gaps or errors is of vital importance for the integrity of the whole
telemetry database. Having the database set up this way means we never have to
manually assign locations to animals, which would for sure lead to errors, but
it also means that any analysis downstream hinges on keeping the deployments
table up-to-date with new captures, tag retrievals, and deaths. This is just one
example of how databases can save us time and ensure data integrity with minimal
routine effort, but only if the data is curated with care in the first place.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="relational-databases.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rsqlite.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["reproducible-science.pdf", "reproducible-science.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
