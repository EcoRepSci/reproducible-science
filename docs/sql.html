<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science</title>
  <meta name="description" content="WILD 6900: Computational Tools for Reproducible Science" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="WILD 6900: Computational Tools for Reproducible Science" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Basics of SQL Language | Computational Tools for Reproducible Science" />
  
  <meta name="twitter:description" content="WILD 6900: Computational Tools for Reproducible Science" />
  

<meta name="author" content="Simona Picardi" />


<meta name="date" content="2021-01-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="relational-databases.html"/>
<link rel="next" href="rsqlite.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Course Material</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#software-requirements-and-installation-instructions"><i class="fa fa-check"></i><b>0.1</b> Software Requirements and Installation Instructions</a><ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#git"><i class="fa fa-check"></i><b>0.1.1</b> Git</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#spreadsheet-editor"><i class="fa fa-check"></i><b>0.1.2</b> Spreadsheet Editor</a></li>
<li class="chapter" data-level="0.1.3" data-path="index.html"><a href="index.html#sqlite"><i class="fa fa-check"></i><b>0.1.3</b> SQLite</a></li>
<li class="chapter" data-level="0.1.4" data-path="index.html"><a href="index.html#r"><i class="fa fa-check"></i><b>0.1.4</b> R</a></li>
<li class="chapter" data-level="0.1.5" data-path="index.html"><a href="index.html#rstudio"><i class="fa fa-check"></i><b>0.1.5</b> RStudio</a></li>
<li class="chapter" data-level="0.1.6" data-path="index.html"><a href="index.html#required-r-packages"><i class="fa fa-check"></i><b>0.1.6</b> Required R Packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="project-organization.html"><a href="project-organization.html"><i class="fa fa-check"></i><b>1</b> Project Organization</a><ul>
<li class="chapter" data-level="1.1" data-path="project-organization.html"><a href="project-organization.html#directory-structure"><i class="fa fa-check"></i><b>1.1</b> Directory structure</a><ul>
<li class="chapter" data-level="1.1.1" data-path="project-organization.html"><a href="project-organization.html#overlap"><i class="fa fa-check"></i><b>1.1.1</b> Overlap</a></li>
<li class="chapter" data-level="1.1.2" data-path="project-organization.html"><a href="project-organization.html#minimizing-duplication"><i class="fa fa-check"></i><b>1.1.2</b> Minimizing duplication</a></li>
<li class="chapter" data-level="1.1.3" data-path="project-organization.html"><a href="project-organization.html#self-containedness"><i class="fa fa-check"></i><b>1.1.3</b> Self-containedness</a></li>
<li class="chapter" data-level="1.1.4" data-path="project-organization.html"><a href="project-organization.html#tradeoffs"><i class="fa fa-check"></i><b>1.1.4</b> Tradeoffs</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="project-organization.html"><a href="project-organization.html#golden-rules"><i class="fa fa-check"></i><b>1.2</b> Golden rules</a></li>
<li class="chapter" data-level="1.3" data-path="project-organization.html"><a href="project-organization.html#be-flexible"><i class="fa fa-check"></i><b>1.3</b> Be flexible</a></li>
<li class="chapter" data-level="1.4" data-path="project-organization.html"><a href="project-organization.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a></li>
<li class="chapter" data-level="1.5" data-path="project-organization.html"><a href="project-organization.html#naming-files"><i class="fa fa-check"></i><b>1.5</b> Naming files</a><ul>
<li class="chapter" data-level="1.5.1" data-path="project-organization.html"><a href="project-organization.html#computer-readable-file-names"><i class="fa fa-check"></i><b>1.5.1</b> Computer-readable file names</a></li>
<li class="chapter" data-level="1.5.2" data-path="project-organization.html"><a href="project-organization.html#human-readable-file-names"><i class="fa fa-check"></i><b>1.5.2</b> Human-readable file names</a></li>
<li class="chapter" data-level="1.5.3" data-path="project-organization.html"><a href="project-organization.html#file-names-that-work-well-with-default-ordering"><i class="fa fa-check"></i><b>1.5.3</b> File names that work well with default ordering</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="project-organization.html"><a href="project-organization.html#rstudio-projects"><i class="fa fa-check"></i><b>1.6</b> RStudio Projects</a></li>
<li class="chapter" data-level="1.7" data-path="project-organization.html"><a href="project-organization.html#relative-and-absolute-paths"><i class="fa fa-check"></i><b>1.7</b> Relative and absolute paths</a><ul>
<li class="chapter" data-level="1.7.1" data-path="project-organization.html"><a href="project-organization.html#path-separators"><i class="fa fa-check"></i><b>1.7.1</b> Path separators</a></li>
<li class="chapter" data-level="1.7.2" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>1.7.2</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="version-control-git.html"><a href="version-control-git.html"><i class="fa fa-check"></i><b>2</b> Version Control with Git</a><ul>
<li class="chapter" data-level="2.1" data-path="version-control-git.html"><a href="version-control-git.html#command-line-basics"><i class="fa fa-check"></i><b>2.1</b> Command line basics</a></li>
<li class="chapter" data-level="2.2" data-path="version-control-git.html"><a href="version-control-git.html#configuring-git"><i class="fa fa-check"></i><b>2.2</b> Configuring Git</a></li>
<li class="chapter" data-level="2.3" data-path="version-control-git.html"><a href="version-control-git.html#getting-help"><i class="fa fa-check"></i><b>2.3</b> Getting help</a></li>
<li class="chapter" data-level="2.4" data-path="version-control-git.html"><a href="version-control-git.html#creating-a-repository"><i class="fa fa-check"></i><b>2.4</b> Creating a repository</a></li>
<li class="chapter" data-level="2.5" data-path="version-control-git.html"><a href="version-control-git.html#tracking-files"><i class="fa fa-check"></i><b>2.5</b> Tracking files</a></li>
<li class="chapter" data-level="2.6" data-path="version-control-git.html"><a href="version-control-git.html#ignoring-files"><i class="fa fa-check"></i><b>2.6</b> Ignoring files</a></li>
<li class="chapter" data-level="2.7" data-path="version-control-git.html"><a href="version-control-git.html#the-3-states"><i class="fa fa-check"></i><b>2.7</b> The 3 states</a></li>
<li class="chapter" data-level="2.8" data-path="version-control-git.html"><a href="version-control-git.html#un-staging-files"><i class="fa fa-check"></i><b>2.8</b> Un-staging files</a></li>
<li class="chapter" data-level="2.9" data-path="version-control-git.html"><a href="version-control-git.html#recovering-a-previous-version-of-a-file"><i class="fa fa-check"></i><b>2.9</b> Recovering a previous version of a file</a></li>
<li class="chapter" data-level="2.10" data-path="version-control-git.html"><a href="version-control-git.html#removing-git"><i class="fa fa-check"></i><b>2.10</b> Removing Git</a></li>
<li class="chapter" data-level="2.11" data-path="version-control-git.html"><a href="version-control-git.html#git-everyday"><i class="fa fa-check"></i><b>2.11</b> Git everyday</a></li>
<li class="chapter" data-level="2.12" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>2.12</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>3</b> Collaborative Science with GitHub</a><ul>
<li class="chapter" data-level="3.1" data-path="github.html"><a href="github.html#adding-a-remote-to-a-local-repository"><i class="fa fa-check"></i><b>3.1</b> Adding a remote to a local repository</a></li>
<li class="chapter" data-level="3.2" data-path="github.html"><a href="github.html#pushing-to-a-remote-repository"><i class="fa fa-check"></i><b>3.2</b> Pushing to a remote repository</a></li>
<li class="chapter" data-level="3.3" data-path="github.html"><a href="github.html#cloning-a-repository"><i class="fa fa-check"></i><b>3.3</b> Cloning a repository</a></li>
<li class="chapter" data-level="3.4" data-path="github.html"><a href="github.html#synchronizing-changes-among-collaborators"><i class="fa fa-check"></i><b>3.4</b> Synchronizing changes among collaborators</a></li>
<li class="chapter" data-level="3.5" data-path="github.html"><a href="github.html#resolving-conflicts"><i class="fa fa-check"></i><b>3.5</b> Resolving conflicts</a></li>
<li class="chapter" data-level="3.6" data-path="github.html"><a href="github.html#avoiding-conflicts"><i class="fa fa-check"></i><b>3.6</b> Avoiding conflicts</a></li>
<li class="chapter" data-level="3.7" data-path="github.html"><a href="github.html#working-with-branches"><i class="fa fa-check"></i><b>3.7</b> Working with branches</a></li>
<li class="chapter" data-level="3.8" data-path="github.html"><a href="github.html#forking-a-repository"><i class="fa fa-check"></i><b>3.8</b> Forking a repository</a></li>
<li class="chapter" data-level="3.9" data-path="github.html"><a href="github.html#pull-requests"><i class="fa fa-check"></i><b>3.9</b> Pull requests</a></li>
<li class="chapter" data-level="3.10" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>3.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spreadsheets.html"><a href="spreadsheets.html"><i class="fa fa-check"></i><b>4</b> Best Practices in the Use of Spreadsheets</a><ul>
<li class="chapter" data-level="4.1" data-path="spreadsheets.html"><a href="spreadsheets.html#what-are-spreadsheets-good-for"><i class="fa fa-check"></i><b>4.1</b> What are spreadsheets good for?</a></li>
<li class="chapter" data-level="4.2" data-path="spreadsheets.html"><a href="spreadsheets.html#human-readable-vs.-computer-readable-data"><i class="fa fa-check"></i><b>4.2</b> Human-readable vs. computer-readable data</a></li>
<li class="chapter" data-level="4.3" data-path="spreadsheets.html"><a href="spreadsheets.html#tidydata"><i class="fa fa-check"></i><b>4.3</b> Tidy data</a></li>
<li class="chapter" data-level="4.4" data-path="spreadsheets.html"><a href="spreadsheets.html#problematic-practices"><i class="fa fa-check"></i><b>4.4</b> Problematic practices</a><ul>
<li class="chapter" data-level="4.4.1" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-variables-in-a-single-column"><i class="fa fa-check"></i><b>4.4.1</b> Multiple variables in a single column</a></li>
<li class="chapter" data-level="4.4.2" data-path="spreadsheets.html"><a href="spreadsheets.html#rows-for-variables-columns-for-observation"><i class="fa fa-check"></i><b>4.4.2</b> Rows for variables, columns for observation</a></li>
<li class="chapter" data-level="4.4.3" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-tables-in-a-single-spreadsheet"><i class="fa fa-check"></i><b>4.4.3</b> Multiple tables in a single spreadsheet</a></li>
<li class="chapter" data-level="4.4.4" data-path="spreadsheets.html"><a href="spreadsheets.html#multiple-sheets"><i class="fa fa-check"></i><b>4.4.4</b> Multiple sheets</a></li>
<li class="chapter" data-level="4.4.5" data-path="spreadsheets.html"><a href="spreadsheets.html#using-formatting-to-convey-information"><i class="fa fa-check"></i><b>4.4.5</b> Using formatting to convey information</a></li>
<li class="chapter" data-level="4.4.6" data-path="spreadsheets.html"><a href="spreadsheets.html#putting-units-in-cells"><i class="fa fa-check"></i><b>4.4.6</b> Putting units in cells</a></li>
<li class="chapter" data-level="4.4.7" data-path="spreadsheets.html"><a href="spreadsheets.html#using-problematic-column-names"><i class="fa fa-check"></i><b>4.4.7</b> Using problematic column names</a></li>
<li class="chapter" data-level="4.4.8" data-path="spreadsheets.html"><a href="spreadsheets.html#conflating-zeros-and-missing-values"><i class="fa fa-check"></i><b>4.4.8</b> Conflating zeros and missing values</a></li>
<li class="chapter" data-level="4.4.9" data-path="spreadsheets.html"><a href="spreadsheets.html#using-problematic-null-values"><i class="fa fa-check"></i><b>4.4.9</b> Using problematic null values</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spreadsheets.html"><a href="spreadsheets.html#document-document-document"><i class="fa fa-check"></i><b>4.5</b> Document, document, document!</a></li>
<li class="chapter" data-level="4.6" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>4.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="relational-databases.html"><a href="relational-databases.html"><i class="fa fa-check"></i><b>5</b> Relational Databases</a><ul>
<li class="chapter" data-level="5.1" data-path="relational-databases.html"><a href="relational-databases.html#what-is-a-relational-database"><i class="fa fa-check"></i><b>5.1</b> What is a relational database?</a></li>
<li class="chapter" data-level="5.2" data-path="relational-databases.html"><a href="relational-databases.html#why-bothering-with-relational-databases"><i class="fa fa-check"></i><b>5.2</b> Why bothering with relational databases?</a></li>
<li class="chapter" data-level="5.3" data-path="relational-databases.html"><a href="relational-databases.html#database-components"><i class="fa fa-check"></i><b>5.3</b> Database components</a></li>
<li class="chapter" data-level="5.4" data-path="relational-databases.html"><a href="relational-databases.html#database-design-and-architecture"><i class="fa fa-check"></i><b>5.4</b> Database design and architecture</a></li>
<li class="chapter" data-level="5.5" data-path="relational-databases.html"><a href="relational-databases.html#data-types"><i class="fa fa-check"></i><b>5.5</b> Data types</a></li>
<li class="chapter" data-level="5.6" data-path="relational-databases.html"><a href="relational-databases.html#a-first-look-at-our-practice-database"><i class="fa fa-check"></i><b>5.6</b> A first look at our practice database</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>6</b> Basics of SQL Language</a><ul>
<li class="chapter" data-level="6.1" data-path="sql.html"><a href="sql.html#the-sql-language"><i class="fa fa-check"></i><b>6.1</b> The SQL language</a></li>
<li class="chapter" data-level="6.2" data-path="sql.html"><a href="sql.html#writing-sql-queries"><i class="fa fa-check"></i><b>6.2</b> Writing SQL queries</a><ul>
<li class="chapter" data-level="6.2.1" data-path="sql.html"><a href="sql.html#limiting-results"><i class="fa fa-check"></i><b>6.2.1</b> Limiting results</a></li>
<li class="chapter" data-level="6.2.2" data-path="sql.html"><a href="sql.html#sorting-results"><i class="fa fa-check"></i><b>6.2.2</b> Sorting results</a></li>
<li class="chapter" data-level="6.2.3" data-path="sql.html"><a href="sql.html#finding-unique-values"><i class="fa fa-check"></i><b>6.2.3</b> Finding unique values</a></li>
<li class="chapter" data-level="6.2.4" data-path="sql.html"><a href="sql.html#filtering"><i class="fa fa-check"></i><b>6.2.4</b> Filtering</a></li>
<li class="chapter" data-level="6.2.5" data-path="sql.html"><a href="sql.html#calculations"><i class="fa fa-check"></i><b>6.2.5</b> Calculations</a></li>
<li class="chapter" data-level="6.2.6" data-path="sql.html"><a href="sql.html#aggregate-functions"><i class="fa fa-check"></i><b>6.2.6</b> Aggregate functions</a></li>
<li class="chapter" data-level="6.2.7" data-path="sql.html"><a href="sql.html#aliases"><i class="fa fa-check"></i><b>6.2.7</b> Aliases</a></li>
<li class="chapter" data-level="6.2.8" data-path="sql.html"><a href="sql.html#grouping"><i class="fa fa-check"></i><b>6.2.8</b> Grouping</a></li>
<li class="chapter" data-level="6.2.9" data-path="sql.html"><a href="sql.html#filtering-based-on-computed-values"><i class="fa fa-check"></i><b>6.2.9</b> Filtering based on computed values</a></li>
<li class="chapter" data-level="6.2.10" data-path="sql.html"><a href="sql.html#null-values"><i class="fa fa-check"></i><b>6.2.10</b> Null values</a></li>
<li class="chapter" data-level="6.2.11" data-path="sql.html"><a href="sql.html#joins"><i class="fa fa-check"></i><b>6.2.11</b> Joins</a></li>
<li class="chapter" data-level="6.2.12" data-path="sql.html"><a href="sql.html#nested-select-statements"><i class="fa fa-check"></i><b>6.2.12</b> Nested <code>SELECT</code> statements</a></li>
<li class="chapter" data-level="6.2.13" data-path="sql.html"><a href="sql.html#order-of-operations"><i class="fa fa-check"></i><b>6.2.13</b> Order of operations</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="sql.html"><a href="sql.html#building-a-database"><i class="fa fa-check"></i><b>6.3</b> Building a database</a><ul>
<li class="chapter" data-level="6.3.1" data-path="sql.html"><a href="sql.html#creating-a-new-database-in-sqlite-studio"><i class="fa fa-check"></i><b>6.3.1</b> Creating a new database in SQLite Studio</a></li>
<li class="chapter" data-level="6.3.2" data-path="sql.html"><a href="sql.html#creating-tables"><i class="fa fa-check"></i><b>6.3.2</b> Creating tables</a></li>
<li class="chapter" data-level="6.3.3" data-path="sql.html"><a href="sql.html#adding-constraints"><i class="fa fa-check"></i><b>6.3.3</b> Adding constraints</a></li>
<li class="chapter" data-level="6.3.4" data-path="sql.html"><a href="sql.html#order-of-table-creation"><i class="fa fa-check"></i><b>6.3.4</b> Order of table creation</a></li>
<li class="chapter" data-level="6.3.5" data-path="sql.html"><a href="sql.html#populating-the-tables"><i class="fa fa-check"></i><b>6.3.5</b> Populating the tables</a></li>
<li class="chapter" data-level="6.3.6" data-path="sql.html"><a href="sql.html#autoincrements-as-primary-keys"><i class="fa fa-check"></i><b>6.3.6</b> Autoincrements as primary keys</a></li>
<li class="chapter" data-level="6.3.7" data-path="sql.html"><a href="sql.html#foreign-keys"><i class="fa fa-check"></i><b>6.3.7</b> Foreign keys</a></li>
<li class="chapter" data-level="6.3.8" data-path="sql.html"><a href="sql.html#crossing-existing-information-to-derive-new-tables"><i class="fa fa-check"></i><b>6.3.8</b> Crossing existing information to derive new tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rsqlite.html"><a href="rsqlite.html"><i class="fa fa-check"></i><b>7</b> Linking Databases and R with RSQLite</a></li>
<li class="chapter" data-level="8" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>8</b> Dynamic Documents with RMarkdown</a></li>
<li class="chapter" data-level="9" data-path="github-pages.html"><a href="github-pages.html"><i class="fa fa-check"></i><b>9</b> Automatically Generated Websites with GitHub Pages</a><ul>
<li class="chapter" data-level="9.1" data-path="github-pages.html"><a href="github-pages.html#bookdown"><i class="fa fa-check"></i><b>9.1</b> Bookdown</a><ul>
<li class="chapter" data-level="9.1.1" data-path="github-pages.html"><a href="github-pages.html#creating-a-book"><i class="fa fa-check"></i><b>9.1.1</b> Creating a book</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="github-pages.html"><a href="github-pages.html#publishing-a-book-with-github-pages"><i class="fa fa-check"></i><b>9.2</b> Publishing a book with GitHub Pages</a><ul>
<li class="chapter" data-level="9.2.1" data-path="github-pages.html"><a href="github-pages.html#step-1-set-up-compatibility-with-github-pages"><i class="fa fa-check"></i><b>9.2.1</b> Step 1: Set up compatibility with GitHub Pages</a></li>
<li class="chapter" data-level="9.2.2" data-path="github-pages.html"><a href="github-pages.html#step-2-set-up-git-repository"><i class="fa fa-check"></i><b>9.2.2</b> Step 2: Set up Git repository</a></li>
<li class="chapter" data-level="9.2.3" data-path="github-pages.html"><a href="github-pages.html#step-3-link-git-repository-to-remote-github-repository"><i class="fa fa-check"></i><b>9.2.3</b> Step 3: Link Git repository to remote GitHub repository</a></li>
<li class="chapter" data-level="9.2.4" data-path="github-pages.html"><a href="github-pages.html#step-4-enable-github-pages"><i class="fa fa-check"></i><b>9.2.4</b> Step 4: Enable GitHub Pages</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="github-pages.html"><a href="github-pages.html#maintaining-the-website"><i class="fa fa-check"></i><b>9.3</b> Maintaining the website</a></li>
<li class="chapter" data-level="9.4" data-path="project-organization.html"><a href="project-organization.html#references"><i class="fa fa-check"></i><b>9.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>10</b> Introduction to R</a></li>
<li class="chapter" data-level="11" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>11</b> Troubleshooting in R</a></li>
<li class="chapter" data-level="12" data-path="renv.html"><a href="renv.html"><i class="fa fa-check"></i><b>12</b> Working Environments in R</a></li>
<li class="chapter" data-level="13" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>13</b> Data Wrangling with tidyverse</a></li>
<li class="chapter" data-level="14" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>14</b> Data Visualization with ggplot2</a></li>
<li class="chapter" data-level="15" data-path="geospatial.html"><a href="geospatial.html"><i class="fa fa-check"></i><b>15</b> Introduction to Geospatial Data in R</a></li>
<li class="chapter" data-level="16" data-path="problem-decomposition.html"><a href="problem-decomposition.html"><i class="fa fa-check"></i><b>16</b> Problem Decomposition</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Tools for Reproducible Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sql" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Basics of SQL Language</h1>
<div id="the-sql-language" class="section level2">
<h2><span class="header-section-number">6.1</span> The SQL language</h2>
<p>The acronym SQL stands for Structured Query Language. It is the most used
language worldwide for relational database management systems. Whenever you
interact with a database in your daily life (for example, any time you browse an
online shopping website, or any time you look up something on Google), you can
bet that it was written in SQL.</p>
<p>SQL is a language that is used and understood by different database management
systems, such as Oracle, PostgreSQL, MySQL, or SQLite. While all these programs
share many similarities, which one of these you’ll end up using depends on
the specifics of what you need it for. For the purposes of this class, we’ll be
using SQLite. SQLite provides all the core functionalities you’ll need to get
familiar with databases while being lightweight in terms of setup (easy to
install and to configure). At the end of this chapter, we’ll talk about why you
may want to make a different choice in the future, but for now we’ll stick with
SQLite.</p>
<p>Each database management program uses a slightly different dialect of SQL. The
language is the same, but there may be some slight differences in the syntax
between different programs. I’ll point out throughout the chapter when we
encounter syntax that is specific to the SQLite dialect.</p>
</div>
<div id="writing-sql-queries" class="section level2">
<h2><span class="header-section-number">6.2</span> Writing SQL queries</h2>
<p>The nice thing about SQL is that it sounds a lot like human language. An SQL
statement, or query, always begins with a verb that describes the action we want
to do. A semicolon at the end of the query lets SQL know that we are done
talking. For example:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb47-1"><a href="sql.html#cb47-1"></a><span class="kw">SELECT</span> dragon_id <span class="kw">FROM</span> dragons;</span></code></pre></div>
<p>The verb <code>SELECT</code> is one we’ll be using over and over again. Any time you want
to select data you also have to specify which table you want it from, so the
<code>SELECT</code> clause is always followed by a <code>FROM</code> clause. In this case, we asked
to see the column <code>dragon_id</code> from the <code>dragons</code> table. Sounds like English,
right?</p>
<p>If we want to see multiple columns, we can list them separated by commas:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb48-1"><a href="sql.html#cb48-1"></a><span class="kw">SELECT</span> dragon_id, sex </span>
<span id="cb48-2"><a href="sql.html#cb48-2"></a><span class="kw">FROM</span> dragons;</span></code></pre></div>
<p>And if we want to see the whole table (not specific columns), we can use a
wildcard:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb49-1"><a href="sql.html#cb49-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb49-2"><a href="sql.html#cb49-2"></a><span class="kw">FROM</span> dragons;</span></code></pre></div>
<div id="limiting-results" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Limiting results</h3>
<p>If the whole table is too big and we only want to take a look at the first, say,
10 rows, we can add a <code>LIMIT</code> clause:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb50-1"><a href="sql.html#cb50-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb50-2"><a href="sql.html#cb50-2"></a><span class="kw">FROM</span> dragons </span>
<span id="cb50-3"><a href="sql.html#cb50-3"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
</div>
<div id="sorting-results" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Sorting results</h3>
<p>One thing to remember with SQL is that the data returned by a <code>SELECT</code> statement
does not necessarily return the data in any specific order unless we tell it to.
You can never assume the output is already sorted. To be explicit about how you
want the data ordered, you can add an <code>ORDER BY</code> clause:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb51-1"><a href="sql.html#cb51-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb51-2"><a href="sql.html#cb51-2"></a><span class="kw">FROM</span> dragons </span>
<span id="cb51-3"><a href="sql.html#cb51-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> species</span>
<span id="cb51-4"><a href="sql.html#cb51-4"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>The default ordering will be ascending. If we want descending ordering instead,
we can specify that as follows:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb52-1"><a href="sql.html#cb52-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb52-2"><a href="sql.html#cb52-2"></a><span class="kw">FROM</span> dragons </span>
<span id="cb52-3"><a href="sql.html#cb52-3"></a><span class="kw">ORDER</span> <span class="kw">BY</span> species <span class="kw">DESC</span></span>
<span id="cb52-4"><a href="sql.html#cb52-4"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
</div>
<div id="finding-unique-values" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Finding unique values</h3>
<p>Say that we wanted to know what species of dragons are in the database. We can
ask for unique values as follows:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb53-1"><a href="sql.html#cb53-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> species </span>
<span id="cb53-2"><a href="sql.html#cb53-2"></a><span class="kw">FROM</span> dragons;</span></code></pre></div>
</div>
<div id="filtering" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Filtering</h3>
<p>We can filter data based on any logical condition using a <code>WHERE</code> clause. For
instance, say that we we only want Norwegian Ridgebacks:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb54-1"><a href="sql.html#cb54-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb54-2"><a href="sql.html#cb54-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb54-3"><a href="sql.html#cb54-3"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span>;</span></code></pre></div>
<p>We can specify multiple conditions at once. For example, if we want only female
Norwegian Ridgebacks:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="sql.html#cb55-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb55-2"><a href="sql.html#cb55-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb55-3"><a href="sql.html#cb55-3"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span> <span class="kw">AND</span> sex <span class="op">=</span> <span class="st">&#39;F&#39;</span>;</span></code></pre></div>
<p>In the example above, both conditions have to be satisfied at once – dragons
have to be Norwegian Ridgeback <strong>and</strong> females to appear in the results. What if
we want to return data where <strong>at least</strong> one of two conditions is satisfied?
The following query will return dragons that are either Norwegian Ridgebacks or
Peruvian Vipertooths:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="sql.html#cb56-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb56-2"><a href="sql.html#cb56-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb56-3"><a href="sql.html#cb56-3"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span> <span class="kw">OR</span> species <span class="op">=</span> <span class="st">&#39;Peruvian Vipertooth&#39;</span>;</span></code></pre></div>
<p>A more concise way to write the same query would be:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="sql.html#cb57-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb57-2"><a href="sql.html#cb57-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb57-3"><a href="sql.html#cb57-3"></a><span class="kw">WHERE</span> species <span class="kw">IN</span> (<span class="st">&#39;Norwegian Ridgeback&#39;</span>, <span class="st">&#39;Peruvian Vipertooth&#39;</span>);</span></code></pre></div>
<p>Logical conditions also include “greater than”, “less than”, “not equal to”.
For instance, we can exclude Norwegian Ridgeback like so:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb58-1"><a href="sql.html#cb58-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb58-2"><a href="sql.html#cb58-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb58-3"><a href="sql.html#cb58-3"></a><span class="kw">WHERE</span> species <span class="op">!=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span>;</span></code></pre></div>
<p>Let’s see some examples with numbers using the morphometrics table. The
following query returns any dragons with wingspan greater than 8 meters
(incidentally, you can include comments in SQL is by using a double dash):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb59-1"><a href="sql.html#cb59-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb59-2"><a href="sql.html#cb59-2"></a><span class="kw">FROM</span> morphometrics</span>
<span id="cb59-3"><a href="sql.html#cb59-3"></a><span class="kw">WHERE</span> wingspan_cm <span class="op">&gt;</span> <span class="dv">800</span>; <span class="co">-- 800 cm is 8 meters</span></span></code></pre></div>
<p>We can also sort the output of the filter:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb60-1"><a href="sql.html#cb60-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb60-2"><a href="sql.html#cb60-2"></a><span class="kw">FROM</span> morphometrics</span>
<span id="cb60-3"><a href="sql.html#cb60-3"></a><span class="kw">WHERE</span> wingspan_cm <span class="op">&gt;</span> <span class="dv">800</span> </span>
<span id="cb60-4"><a href="sql.html#cb60-4"></a><span class="kw">ORDER</span> <span class="kw">BY</span> wingspan_cm <span class="kw">DESC</span>;</span></code></pre></div>
</div>
<div id="calculations" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Calculations</h3>
<p>The morphometric measurements are in centimeters, but we often define our
filtering conditions using meters in our minds (see above, “wingspan greater
than 8 meters”). Instead of converting the condition into centimeters, wouldn’t
it be easier to have SQLite transform the data in meters and then evaluate the
condition? We can do this calculation on the fly:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb61-1"><a href="sql.html#cb61-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb61-2"><a href="sql.html#cb61-2"></a><span class="kw">FROM</span> morphometrics</span>
<span id="cb61-3"><a href="sql.html#cb61-3"></a><span class="kw">WHERE</span> wingspan_cm<span class="op">/</span><span class="dv">100</span> <span class="op">&gt;</span> <span class="dv">8</span>;</span></code></pre></div>
</div>
<div id="aggregate-functions" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Aggregate functions</h3>
<p>Summary statistics are calculated using aggregate functions in SQL. Counting,
summing, calculating the mean, minimum, maximum values are all examples of
aggregate functions. Let’s see how they work.</p>
<p>If we want to know how many Norwegian Ridgebacks are in the database, we can
use:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb62-1"><a href="sql.html#cb62-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) </span>
<span id="cb62-2"><a href="sql.html#cb62-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb62-3"><a href="sql.html#cb62-3"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span>;</span></code></pre></div>
<p>The dragons table has no repeated IDs, so we shouldn’t have counted anybody
twice. However, let’s double check if that’s true by specifying that we want
to only count distinct IDs:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb63-1"><a href="sql.html#cb63-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dragon_id) </span>
<span id="cb63-2"><a href="sql.html#cb63-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb63-3"><a href="sql.html#cb63-3"></a><span class="kw">WHERE</span> species <span class="op">=</span> <span class="st">&#39;Norwegian Ridgeback&#39;</span>;</span></code></pre></div>
<p>Now let’s see how to calculate some summary stats on dragon morphometrics. What
is the mean total body length of dragons in our sample?</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb64-1"><a href="sql.html#cb64-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(total_body_length_cm)</span>
<span id="cb64-2"><a href="sql.html#cb64-2"></a><span class="kw">FROM</span> morphometrics;</span></code></pre></div>
<p>We can also calculate several different things at once:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb65-1"><a href="sql.html#cb65-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(total_body_length_cm), <span class="fu">MIN</span>(total_body_length_cm), <span class="fu">MAX</span>(total_body_length_cm)</span>
<span id="cb65-2"><a href="sql.html#cb65-2"></a><span class="kw">FROM</span> morphometrics;</span></code></pre></div>
</div>
<div id="aliases" class="section level3">
<h3><span class="header-section-number">6.2.7</span> Aliases</h3>
<p>Aliases are temporary names that we can assign to a column (or a table) during
the execution of a query. For example, we can use an alias to rename the output
of our mean body length calculation:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb66-1"><a href="sql.html#cb66-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(total_body_length_cm) <span class="kw">AS</span> mean_body_length</span>
<span id="cb66-2"><a href="sql.html#cb66-2"></a><span class="kw">FROM</span> morphometrics;</span></code></pre></div>
</div>
<div id="grouping" class="section level3">
<h3><span class="header-section-number">6.2.8</span> Grouping</h3>
<p>If we want to apply the same calculation to different groups within the data,
we can use the <code>GROUP BY</code> clause. <code>GROUP BY</code> is used in conjunction with an
aggregate function to return the computed values broken down by group. For
instance, if we want to count how many dragons we have for each species (and
sort them from the most numerous to the least numerous):</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb67-1"><a href="sql.html#cb67-1"></a><span class="kw">SELECT</span> species, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> n_dragons</span>
<span id="cb67-2"><a href="sql.html#cb67-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb67-3"><a href="sql.html#cb67-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species</span>
<span id="cb67-4"><a href="sql.html#cb67-4"></a><span class="kw">ORDER</span> <span class="kw">BY</span> n_dragons <span class="kw">DESC</span>;</span></code></pre></div>
</div>
<div id="filtering-based-on-computed-values" class="section level3">
<h3><span class="header-section-number">6.2.9</span> Filtering based on computed values</h3>
<p>If we want to apply any filtering to our results based on calculated values, the
<code>WHERE</code> clause is not going to work. Instead, a <code>HAVING</code> clause is used in
combination with an aggregate function and a <code>GROUP BY</code>. <code>HAVING</code> does the same
thing as <code>WHERE</code> except that it handles logical conditions on computed values.
For example, say that we want to count how many individuals we have in our
database and then only keep the species for which we have at least 50 individuals.
The following query counts how many individual dragons we have for each species:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb68-1"><a href="sql.html#cb68-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dragon_id) <span class="kw">AS</span> n_dragons, species</span>
<span id="cb68-2"><a href="sql.html#cb68-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb68-3"><a href="sql.html#cb68-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species;</span></code></pre></div>
<p>Because the count is a calculated value (the output of the aggregate function
<code>COUNT</code>), if we try to apply a filter using <code>WHERE</code> we’ll get an error:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb69-1"><a href="sql.html#cb69-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dragon_id) <span class="kw">AS</span> n_dragons, species</span>
<span id="cb69-2"><a href="sql.html#cb69-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb69-3"><a href="sql.html#cb69-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species</span>
<span id="cb69-4"><a href="sql.html#cb69-4"></a><span class="kw">WHERE</span> n_dragons <span class="op">&gt;</span> <span class="dv">50</span>;</span></code></pre></div>
<p>Instead, we can use <code>HAVING</code>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb70-1"><a href="sql.html#cb70-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> dragon_id) <span class="kw">AS</span> n_dragons, species</span>
<span id="cb70-2"><a href="sql.html#cb70-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb70-3"><a href="sql.html#cb70-3"></a><span class="kw">GROUP</span> <span class="kw">BY</span> species</span>
<span id="cb70-4"><a href="sql.html#cb70-4"></a><span class="kw">HAVING</span> n_dragons <span class="op">&gt;</span> <span class="dv">50</span>;</span></code></pre></div>
</div>
<div id="null-values" class="section level3">
<h3><span class="header-section-number">6.2.10</span> Null values</h3>
<p>Missing values in SQL are represented as <code>NULL</code>. We can filter (or filter out)
these values using the <code>IS NULL</code> operator:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb71-1"><a href="sql.html#cb71-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb71-2"><a href="sql.html#cb71-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb71-3"><a href="sql.html#cb71-3"></a><span class="kw">WHERE</span> sex <span class="kw">IS</span> <span class="kw">NULL</span>;</span></code></pre></div>
<p>The query above returns all the dragons for which sex is unknown. If we want to
exclude any individuals for which sex is unknown, then we can add the <code>NOT</code>
operator to our statement:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb72-1"><a href="sql.html#cb72-1"></a><span class="kw">SELECT</span> <span class="op">*</span> </span>
<span id="cb72-2"><a href="sql.html#cb72-2"></a><span class="kw">FROM</span> dragons</span>
<span id="cb72-3"><a href="sql.html#cb72-3"></a><span class="kw">WHERE</span> sex <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code></pre></div>
</div>
<div id="joins" class="section level3">
<h3><span class="header-section-number">6.2.11</span> Joins</h3>
<p>So far, we have learned how to query data from a single table. But what if we
need to combine information from multiple tables to get the result we want?
Let’s make an example. Say that we want to calculate the average wingspan for
male versus female dragons. The wingspan measurements are in the morphometrics
table. However, the morphometrics table does not have a “sex” column. The
information on sex is in the dragons table. To get our answer, we need to
combine information from the dragons and morphometrics tables. To do so, we
introduce SQL joins.</p>
<p>Joins are the heart of relational database use. Without joins, there is no point
in a relational database because we can’t take advantage of the relations
between tables. Joins exploit the links we established between tables via
foreign keys to combine information across them.</p>
<p>There are several types of join. The most common types are left join, inner
join, or full join. To understand this terminology, consider this:
whenever you are joining two tables, the first table you mention (the one to
which you’re joining) is called the <strong>left</strong> table, whereas the second table
(the one you’re joining to the first) is called the <strong>right</strong> table. With a left
join, you keep all the records in the left table and add information from the
right table whenever there’s a matching row. A full join means that you retain
all rows from both tables, matching them whenever possible. An inner join means
that you only retain the rows that match between the two tables.</p>
<p>img</p>
<p>Let’s look at this in practice and it will make more sense. Our database
contains a deployments table and a morphometrics table. Not all dragons that
were tracked were also measured. If we do a left join using the deployments as
the left table, we get in output the whole deployments table (all the dragons
that were tracked) with the associated morphometric information whenever
available (for the dragons that were also measured):</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb73-1"><a href="sql.html#cb73-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb73-2"><a href="sql.html#cb73-2"></a><span class="kw">FROM</span> deployments <span class="co">-- this is our left table</span></span>
<span id="cb73-3"><a href="sql.html#cb73-3"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> morphometrics <span class="co">-- this is our right table </span></span>
<span id="cb73-4"><a href="sql.html#cb73-4"></a><span class="kw">ON</span> deployments.dragon_id <span class="op">=</span> morphometrics.dragon_id <span class="co">-- this is the shared column</span></span>
<span id="cb73-5"><a href="sql.html#cb73-5"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>Since the shared column is named the same in the two tables (<code>dragon_id</code>), I had
to specify which table I was referring to each time in the <code>ON</code> clause, or it
would have been ambiguous. The syntax to do so is <code>table.column</code>. Also note that,
because the dragon ID column appears in both tables and we did not specify which
table we wanted it from, SQLite is duplicating it. To avoid that, we need to get
rid of the wildcard and spell out the name of each of the columns we want in
output (also specifying the table when ambiguous):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb74-1"><a href="sql.html#cb74-1"></a><span class="kw">SELECT</span> deployments.dragon_id, <span class="dt">date</span>, tag_id, start_deployment, end_deployment,</span>
<span id="cb74-2"><a href="sql.html#cb74-2"></a>total_body_length_cm, wingspan_cm, tail_length_cm, tarsus_length_cm, claw_length_cm</span>
<span id="cb74-3"><a href="sql.html#cb74-3"></a><span class="kw">FROM</span> deployments </span>
<span id="cb74-4"><a href="sql.html#cb74-4"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> morphometrics </span>
<span id="cb74-5"><a href="sql.html#cb74-5"></a><span class="kw">ON</span> deployments.dragon_id <span class="op">=</span> morphometrics.dragon_id </span>
<span id="cb74-6"><a href="sql.html#cb74-6"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>If we invert the tables (the morphometrics becomes the left table and the
deployments becomes the right), we get in output the whole morphometric table
(all the dragons that were measured) with the associated deployment information
whenever available (for the dragons that were also tracked):</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb75-1"><a href="sql.html#cb75-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb75-2"><a href="sql.html#cb75-2"></a><span class="kw">FROM</span> morphometrics <span class="co">-- this is our left table</span></span>
<span id="cb75-3"><a href="sql.html#cb75-3"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> deployments <span class="co">-- this is our right table </span></span>
<span id="cb75-4"><a href="sql.html#cb75-4"></a><span class="kw">ON</span> morphometrics.dragon_id <span class="op">=</span> deployments.dragon_id </span>
<span id="cb75-5"><a href="sql.html#cb75-5"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>An inner join only keeps the rows that match between two tables. In this case,
that means we only get in output data for animals that were both tracked <strong>and</strong>
measured:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb76-1"><a href="sql.html#cb76-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb76-2"><a href="sql.html#cb76-2"></a><span class="kw">FROM</span> morphometrics</span>
<span id="cb76-3"><a href="sql.html#cb76-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> deployments </span>
<span id="cb76-4"><a href="sql.html#cb76-4"></a><span class="kw">ON</span> morphometrics.dragon_id <span class="op">=</span> deployments.dragon_id </span>
<span id="cb76-5"><a href="sql.html#cb76-5"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>A full join keeps all records from both the left and the right table, matching
them whenever possible. That is, we get in output all the dragons, with blanks
in the morphometrics table for those that were only tracked and blanks in the
deployments table for those that were only measured. Unfortunately, SQLite does
not support full joins, so we cannot demonstrate it here, but it’s important to
know that a full join exists and what it does because you’ll find yourself using
it in any other database management program or even in R (see Chapter <a href="tidyverse.html#tidyverse">13</a>).</p>
</div>
<div id="nested-select-statements" class="section level3">
<h3><span class="header-section-number">6.2.12</span> Nested <code>SELECT</code> statements</h3>
<p>Now that we know how to use joins, we can go back to our challenge of calculating
the average wingspan for male versus female dragons. What we need to do is add
the sex column to the morphometrics table. We can do this by looking at the
dragon ID, which is the column the two tables have in common. So the join clause
will look like this:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb77-1"><a href="sql.html#cb77-1"></a><span class="kw">SELECT</span> dragon_id, wingspan_cm, sex</span>
<span id="cb77-2"><a href="sql.html#cb77-2"></a><span class="kw">FROM</span> morphometrics <span class="co">-- this is our left table</span></span>
<span id="cb77-3"><a href="sql.html#cb77-3"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> dragons <span class="co">-- this is our left table </span></span>
<span id="cb77-4"><a href="sql.html#cb77-4"></a><span class="kw">ON</span> morphometrics.dragon_id <span class="op">=</span> dragons.dragon_id; <span class="co">-- this is the shared column</span></span></code></pre></div>
<p>By using a left join, we are saying that we want to keep all rows from the left
table (morphometrics) while adding information on sex whenever available. Now we
can compute the average wingspan broken down by sex:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb78-1"><a href="sql.html#cb78-1"></a><span class="kw">SELECT</span> sex, <span class="fu">AVG</span>(wingspan_cm) <span class="kw">AS</span> mean_wingspan</span>
<span id="cb78-2"><a href="sql.html#cb78-2"></a><span class="kw">FROM</span> (</span>
<span id="cb78-3"><a href="sql.html#cb78-3"></a>    <span class="kw">SELECT</span> morphometrics.dragon_id, wingspan_cm, sex</span>
<span id="cb78-4"><a href="sql.html#cb78-4"></a>    <span class="kw">FROM</span> morphometrics </span>
<span id="cb78-5"><a href="sql.html#cb78-5"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> dragons </span>
<span id="cb78-6"><a href="sql.html#cb78-6"></a>    <span class="kw">ON</span> morphometrics.dragon_id <span class="op">=</span> dragons.dragon_id</span>
<span id="cb78-7"><a href="sql.html#cb78-7"></a>    )</span>
<span id="cb78-8"><a href="sql.html#cb78-8"></a><span class="kw">GROUP</span> <span class="kw">BY</span> sex; </span></code></pre></div>
<p>The one above is a nested query, which means there are two <code>SELECT</code> statements
nested within one another. The inner <code>SELECT</code> statement (everything between the
parentheses) is treated as if it were a table in the database. SQL will
execute the query from the inside out, so even though that table physically does
not exist, it gets temporarily created when the inner query is run and is then
used in input to the second query.</p>
</div>
<div id="order-of-operations" class="section level3">
<h3><span class="header-section-number">6.2.13</span> Order of operations</h3>
<p>The fact that SQL will execute nested queries from the inside out is one aspect
of order of operations. But there’s also a logic to the order in which SQL
executes clauses within a query: first, it gathers the data, then it filters it
and aggregates it as needed, then it computes results, and finally it sorts them
and truncate them if necessary. Let’s look at this step by step:</p>
<ol style="list-style-type: decimal">
<li>First, SQL executes the <code>FROM</code> clause and any
<code>JOIN</code> clauses, if present, to determine what tables are being queried.</li>
<li>Then, it will execute the <code>WHERE</code> clause to filter the data.</li>
<li>Then, it will <code>GROUP BY</code> the column/s of interest.</li>
<li>Then it will calculate any derived values based on aggregate functions.</li>
<li>Then, it will apply any filters specified by <code>HAVING</code>.</li>
<li>Now, and only now, it will execute the <code>SELECT</code> clause!</li>
<li>Once the computations are completed and the output of <code>SELECT</code> is ready,
SQL can start refining it. First, it will discard any duplicates if <code>DISTINCT</code>
is specified.</li>
<li>Then, it will sort the results based on <code>ORDER BY</code>.</li>
<li>Finally, it will truncate the output if a <code>LIMIT</code> is specified.</li>
</ol>
<p>If you think about it, all of this makes logical sense. You can’t select a
column if you’re not sure what table to look in. You can’t compute a per-group
count before defining the groups. You can’t order results that you haven’t
computed yet. But then why do we start our queries with <code>SELECT</code>? And does the
order in which we write our queries matter?</p>
<p>The answer to both of those questions is that there is a difference between the
<em>logical</em> order of operations and the <em>lexical</em> (or syntactical) order of
operations, which is how we actually write queries. Even though these don’t
correspond, writing a query in any other order than the following is incorrect
(and will return an error):</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb79-1"><a href="sql.html#cb79-1"></a><span class="kw">SELECT</span> </span>
<span id="cb79-2"><a href="sql.html#cb79-2"></a><span class="kw">FROM</span> </span>
<span id="cb79-3"><a href="sql.html#cb79-3"></a>    <span class="kw">JOIN</span> </span>
<span id="cb79-4"><a href="sql.html#cb79-4"></a>      <span class="kw">ON</span> </span>
<span id="cb79-5"><a href="sql.html#cb79-5"></a>    <span class="kw">WHERE</span> </span>
<span id="cb79-6"><a href="sql.html#cb79-6"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb79-7"><a href="sql.html#cb79-7"></a>    <span class="kw">HAVING</span> </span>
<span id="cb79-8"><a href="sql.html#cb79-8"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> </span>
<span id="cb79-9"><a href="sql.html#cb79-9"></a>    <span class="kw">LIMIT</span>;</span></code></pre></div>
</div>
</div>
<div id="building-a-database" class="section level2">
<h2><span class="header-section-number">6.3</span> Building a database</h2>
<div id="creating-a-new-database-in-sqlite-studio" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Creating a new database in SQLite Studio</h3>
<p>We are now going to see how to build a database by recreating the dragons
database we have been practicing on. Let’s open up SQLite Studio and, on the
<em>Database</em> tab, click “Add a database” (or use Ctrl/Cmd + O as a shortcut).
Click on the green plus sign, navigate to the folder where you want to save the
database, and choose a file name. Click “Save”. Now we need to also choose a
name to use internally (this name will appear in the drop-down list of databases
within SQLite, but it does not necessarily need to be the same as the filename.)
Click “OK” and you should see your new database in the list on the left.</p>
</div>
<div id="creating-tables" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Creating tables</h3>
<p>Now let’s open the SQL editor (<em>Tools</em> &gt; <em>SQL editor</em>). Double check that you
are working on the correct database (the name of the active database is shown
in the toolbar). We are ready to create our first table!</p>
<p>To create a table, we need to specify a name for the table, as well as a name
and a data type for each column. The basic format is as follows:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb80-1"><a href="sql.html#cb80-1"></a></span>
<span id="cb80-2"><a href="sql.html#cb80-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> table_name (</span>
<span id="cb80-3"><a href="sql.html#cb80-3"></a>column_1 data_type,</span>
<span id="cb80-4"><a href="sql.html#cb80-4"></a>column_2 data_type,</span>
<span id="cb80-5"><a href="sql.html#cb80-5"></a>column_3 data_type,</span>
<span id="cb80-6"><a href="sql.html#cb80-6"></a><span class="op">..</span>.</span>
<span id="cb80-7"><a href="sql.html#cb80-7"></a>)</span></code></pre></div>
<p>Let’s start by creating the dragons table. Remember that each table needs to
have a primary key, i.e., a column that serves as the unique identifier of each
row. The values in this column need to be unique and cannot be null. In this
table, we can use the dragon ID as the primary key:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb81-1"><a href="sql.html#cb81-1"></a></span>
<span id="cb81-2"><a href="sql.html#cb81-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> dragons (</span>
<span id="cb81-3"><a href="sql.html#cb81-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb81-4"><a href="sql.html#cb81-4"></a>sex <span class="dt">char</span>(<span class="dv">1</span>),</span>
<span id="cb81-5"><a href="sql.html#cb81-5"></a>age_class <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb81-6"><a href="sql.html#cb81-6"></a>species <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb81-7"><a href="sql.html#cb81-7"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span> (dragon_id)</span>
<span id="cb81-8"><a href="sql.html#cb81-8"></a>);</span></code></pre></div>
<p>Notice that I specified a number of digits for each character variable. Because
the format of the dragon ID is “D” + number from 1 up to 500 (for now), setting
the ID as a character string with varying size up to 5 digits allows for IDs
from “D1” to “D9999”. So far, we only have 500 individuals, so strictly it would
have been enough to set the limit to 4 digits only, but it’s good to have some
forethought and allow for growth into the future. At the same time, it seems
reasonable to assume we won’t catch 10 thousand dragons in this project, so 5
digits is a good compromise. In reality, space is rarely limiting to the
point where 4 or 10 digits makes a difference, so when in doubt err on the side
of more room for growth.</p>
<p>While dragon ID, age class, and species have a variable number of digits, sex
always has one (it can be “M” or “F”). So we can make this a <code>char</code> instead of
a <code>varchar</code> and specify it will have 1 digit.</p>
</div>
<div id="adding-constraints" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Adding constraints</h3>
<p>We can also add some constraints for the purpose of quality assurance. For
example, because the dragon ID is the primary key, we can’t accept null values
in this column. Sex is always one of “M” or “F” and age is always one of
“Juvenile”, “Subadult”, or “Adult”. In other SQL dialects you can add these
after the fact, but in SQLite the only way to add these constraints is at the
same time as you create the table. We can delete the table and re-create it by
modifying the above syntax as follows:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb82-1"><a href="sql.html#cb82-1"></a></span>
<span id="cb82-2"><a href="sql.html#cb82-2"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> dragons;</span>
<span id="cb82-3"><a href="sql.html#cb82-3"></a></span>
<span id="cb82-4"><a href="sql.html#cb82-4"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> dragons (</span>
<span id="cb82-5"><a href="sql.html#cb82-5"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb82-6"><a href="sql.html#cb82-6"></a>sex <span class="dt">char</span>(<span class="dv">1</span>) <span class="kw">CHECK</span> (sex <span class="kw">IN</span> (<span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>)),</span>
<span id="cb82-7"><a href="sql.html#cb82-7"></a>age_class <span class="dt">varchar</span>(<span class="dv">8</span>) <span class="kw">CHECK</span> (age_class <span class="kw">IN</span> (<span class="st">&#39;Juvenile&#39;</span>, <span class="st">&#39;Subadult&#39;</span>, <span class="st">&#39;Adult&#39;</span>)),</span>
<span id="cb82-8"><a href="sql.html#cb82-8"></a>species <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb82-9"><a href="sql.html#cb82-9"></a><span class="kw">PRIMARY</span> <span class="kw">KEY</span> (dragon_id)</span>
<span id="cb82-10"><a href="sql.html#cb82-10"></a>);</span></code></pre></div>
</div>
<div id="order-of-table-creation" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Order of table creation</h3>
<p>Foreign keys are also specified as constraints. Because it’s not possible to
enforce constraints as an afterthought, we need to plan the order in which we
add tables carefully. If we try to add a foreign key that refers to a table that
doesn’t exist yet, we won’t be able to. Let’s take another look at the diagram
of our table relationships:</p>
<p>img</p>
<p>Any table that has one or more foreign keys needs to be added <em>after</em> the
related table/s. In our case, there are three “root” tables that do not have
any foreign keys: the dragons table, the tags table, and the capture sites
table. We can add these three first and then all the others.</p>
<p>The tags table has a <code>tag_id</code> field which is unique and can therefore be used as
a primary key. Note that when you make a column the primary key you automatically
enforce a unique constraint on that column. However, SQLite does not enforce a
not-null constraint on primary keys like most other SQL dialects. Because SQLite
doesn’t, we have to do it ourselves:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb83-1"><a href="sql.html#cb83-1"></a></span>
<span id="cb83-2"><a href="sql.html#cb83-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> tags (</span>
<span id="cb83-3"><a href="sql.html#cb83-3"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb83-4"><a href="sql.html#cb83-4"></a>brand <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb83-5"><a href="sql.html#cb83-5"></a>status <span class="dt">varchar</span>(<span class="dv">20</span>)</span>
<span id="cb83-6"><a href="sql.html#cb83-6"></a>);</span></code></pre></div>
<p>The capture sites table has a <code>site</code> field which contains a 3-letter code that
uniquely identifies the site. We can use that as a primary key. The UTM
coordinates are numeric values for which we can use the data type called “double
precision”, or just “double”. There are several possible choices for numeric
data types. “Double precision” and “float” are both suitable data types for
storing real numbers, but double precision stores numeric values
with higher precision than float. Both of these allow for variable decimal
places, whereas the data type “decimal” enforces the same number of decimal
places across records. The choice between these data types depends on 1. whether
we want the measurements to all have the same number of decimal places or not,
and 2. how many significant digits do we expect/care about. Double precision can
store up to 15 significant digits (unlike float which can store up to 8), but it
also occupies double the space (64 bit instead of 32.) For UTM coordinates, the
Y value has a minimum of 7 digits, and we want to keep decimal places because
we need the highest precision possible on the position of animals in space.
Therefore, we’ll go with double precision:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb84-1"><a href="sql.html#cb84-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> capture_sites (</span>
<span id="cb84-2"><a href="sql.html#cb84-2"></a>site <span class="dt">char</span>(<span class="dv">3</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb84-3"><a href="sql.html#cb84-3"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb84-4"><a href="sql.html#cb84-4"></a>utm_y <span class="dt">double</span></span>
<span id="cb84-5"><a href="sql.html#cb84-5"></a>);</span></code></pre></div>
<p>Note that I used an alternative syntax to specify the primary key.
This is equivalent to the one I used above for the dragons table.</p>
</div>
<div id="populating-the-tables" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Populating the tables</h3>
<p>Now that we added a few tables, we can start to populate the database by loading
the data as .csv files. On the <em>Tools</em> tab, click “Import.”</p>
<p>img</p>
<p>Check that the database is correct and then select the table you want to import
data into. For example, let’s start with the dragons table:</p>
<p>img</p>
<p>Click <em>Next</em>. Now, browse your directory to select the input file. Then check
the box that says “First line represents CSV column names”, make sure the field
separator is a comma, and set the <em>NULL</em> values to <code>NA</code> (which is how they are
encoded in the .csv.) Click <em>Finish</em>.</p>
<p>To check if the table was imported correctly, go back into the query editor and
try to look at the first 10 rows:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb85-1"><a href="sql.html#cb85-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> dragons <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>If everything looks good, we can go ahead and import data in the other two
tables.</p>
</div>
<div id="autoincrements-as-primary-keys" class="section level3">
<h3><span class="header-section-number">6.3.6</span> Autoincrements as primary keys</h3>
<p>Sometimes a table does not contain any columns with unique values. This is the
case for all the tables we have left to add. What do we use as primary key in
these situations? Adding a column with a serial number that gets automatically
updated is a good option. SQLite has something called auto-increment, which is
an integer column that automatically increases by 1 each time you add a row to
a table. Because it’s incremental, the values of an auto-increment will always
be unique, and because it’s automatic, they will never be null. Sounds like a
perfect candidate for a primary key.</p>
<p>The problem with using an auto-increment as a primary key arises when you’re
trying to import data from a .csv file. If the column with the auto-increment
does not already exist in the .csv, SQLite won’t let you import the file into
the table because the number of columns does not match. We don’t want to add the
auto-increment into the .csv ourselves because that defeats the purpose of
having SQLite doing it for us. But if we import the .csv as it is (without
primary key) and then add the auto-increment column later, we won’t be able to
make it the primary key because SQLite won’t let us. So, what do we do?</p>
<p>One workaround that people have found to solve this issue is to trick SQLite by
using a temporary table. This is how the process works:</p>
<ol style="list-style-type: decimal">
<li>Create the table the way we want it, with an auto-increment primary key plus
all the columns we want to import from the .csv;</li>
<li>Create a temporary table without primary key that only contains the columns
from the .csv;</li>
<li>Import the .csv into the temporary table;</li>
<li>Populate the final table by pulling data from the temporary table;</li>
<li>Delete the temporary table.</li>
</ol>
<p>A little convoluted, but it does the job. Let’s demonstrate this on the captures
table. First, we create the table like we want it to look in the end (note that
I am adding foreign keys; we’ll go over that part in the next section):</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb86-1"><a href="sql.html#cb86-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> captures (</span>
<span id="cb86-2"><a href="sql.html#cb86-2"></a>capture_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb86-3"><a href="sql.html#cb86-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb86-4"><a href="sql.html#cb86-4"></a><span class="dt">date</span> text,</span>
<span id="cb86-5"><a href="sql.html#cb86-5"></a>site <span class="dt">char</span>(<span class="dv">3</span>),</span>
<span id="cb86-6"><a href="sql.html#cb86-6"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb86-7"><a href="sql.html#cb86-7"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(site) <span class="kw">REFERENCES</span> capture_sites(site)</span>
<span id="cb86-8"><a href="sql.html#cb86-8"></a>);</span></code></pre></div>
<p>Second, we create a temporary table without the primary key (no need to add
foreign keys to this one as we are going to delete it anyway):</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb87-1"><a href="sql.html#cb87-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> captures_temp (</span>
<span id="cb87-2"><a href="sql.html#cb87-2"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb87-3"><a href="sql.html#cb87-3"></a><span class="dt">date</span> text,</span>
<span id="cb87-4"><a href="sql.html#cb87-4"></a>site <span class="dt">char</span>(<span class="dv">3</span>));</span></code></pre></div>
<p>Now on <em>Tools</em> &gt; <em>Import</em>, we upload <code>captures.csv</code> into <code>captures_temp</code>. Then
we can populate the final table as follows:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb88-1"><a href="sql.html#cb88-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> captures(dragon_id, <span class="dt">date</span>, site) <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> captures_temp;</span></code></pre></div>
<p>And finally we delete our temporary table:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb89-1"><a href="sql.html#cb89-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> captures_temp;</span></code></pre></div>
<p>We better get familiar with this workflow because we are going to use it for all
the other tables now.</p>
</div>
<div id="foreign-keys" class="section level3">
<h3><span class="header-section-number">6.3.7</span> Foreign keys</h3>
<p>For each of the remaining tables, we will specify one or more foreign keys to
enforce the relationships between tables. Each foreign key is the primary key of
another table. See for example what we did above: the captures table we just
imported contains information on when and where each dragon was captured. This
means this table needs to have two foreign keys: the <code>dragon_id</code> column links it
to the dragons table and the <code>site</code> column links it to the capture sites table.
Now let’s apply the concept to the other tables.</p>
<p>The morphometrics table will have a single foreign key linking it to the dragons
table (the dragon ID). The second column is a date – SQLite does not have a
dedicated data type for dates. Instead, we stored this as a character string in
ISO8601 format (“YYYY-MM-DD HH:MM:SS.SSS”). This time there is no need for
double precision because we want to only retain up to the third decimal place
and the numbers are not larger than ~3000, so 8 significant digits is sufficient.
We’ll use float as the data type for the measurements. Because individuals may
have been measured multiple times, none of the existing columns are unique. This
means we’ll create a serial number to use as the primary key. We’ll use the same
trick as above:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb90-1"><a href="sql.html#cb90-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> morphometrics (</span>
<span id="cb90-2"><a href="sql.html#cb90-2"></a>measurement_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb90-3"><a href="sql.html#cb90-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb90-4"><a href="sql.html#cb90-4"></a><span class="dt">date</span> text,</span>
<span id="cb90-5"><a href="sql.html#cb90-5"></a>total_body_length_cm <span class="dt">float</span>,</span>
<span id="cb90-6"><a href="sql.html#cb90-6"></a>wingspan_cm <span class="dt">float</span>,</span>
<span id="cb90-7"><a href="sql.html#cb90-7"></a>tail_length_cm <span class="dt">float</span>,</span>
<span id="cb90-8"><a href="sql.html#cb90-8"></a>tarsus_length_cm <span class="dt">float</span>,</span>
<span id="cb90-9"><a href="sql.html#cb90-9"></a>claw_length_cm <span class="dt">float</span>,</span>
<span id="cb90-10"><a href="sql.html#cb90-10"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb90-11"><a href="sql.html#cb90-11"></a>);</span>
<span id="cb90-12"><a href="sql.html#cb90-12"></a></span>
<span id="cb90-13"><a href="sql.html#cb90-13"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> morphometrics_temp (</span>
<span id="cb90-14"><a href="sql.html#cb90-14"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb90-15"><a href="sql.html#cb90-15"></a><span class="dt">date</span> text,</span>
<span id="cb90-16"><a href="sql.html#cb90-16"></a>total_body_length_cm <span class="dt">float</span>,</span>
<span id="cb90-17"><a href="sql.html#cb90-17"></a>wingspan_cm <span class="dt">float</span>,</span>
<span id="cb90-18"><a href="sql.html#cb90-18"></a>tail_length_cm <span class="dt">float</span>,</span>
<span id="cb90-19"><a href="sql.html#cb90-19"></a>tarsus_length_cm <span class="dt">float</span>,</span>
<span id="cb90-20"><a href="sql.html#cb90-20"></a>claw_length_cm <span class="dt">float</span></span>
<span id="cb90-21"><a href="sql.html#cb90-21"></a>);</span></code></pre></div>
<p>Now on <em>Tools</em> &gt; <em>Import</em>, we upload <code>morphometrics.csv</code> into
<code>morphometrics_temp</code>. Then we populate the final table:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb91-1"><a href="sql.html#cb91-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> morphometrics(dragon_id, <span class="dt">date</span>, total_body_length_cm, wingspan_cm,</span>
<span id="cb91-2"><a href="sql.html#cb91-2"></a>tail_length_cm, tarsus_length_cm, claw_length_cm) </span>
<span id="cb91-3"><a href="sql.html#cb91-3"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> morphometrics_temp;</span></code></pre></div>
<p>And delete our temporary table:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb92-1"><a href="sql.html#cb92-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> morphometrics_temp;</span></code></pre></div>
<p>The diet table contains repeated sample IDs and repeated item IDs within each
sample. We’ll need a serial number here too because none of the columns are
unique. The item ID is an integer so we are going to use a new numeric data type
for it. The foreign key will be, again, the dragon ID referring to the dragons
table:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb93-1"><a href="sql.html#cb93-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> diet (</span>
<span id="cb93-2"><a href="sql.html#cb93-2"></a>diet_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb93-3"><a href="sql.html#cb93-3"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb93-4"><a href="sql.html#cb93-4"></a>sample_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb93-5"><a href="sql.html#cb93-5"></a><span class="dt">date</span> text,</span>
<span id="cb93-6"><a href="sql.html#cb93-6"></a>item_id <span class="dt">integer</span>,</span>
<span id="cb93-7"><a href="sql.html#cb93-7"></a>item <span class="dt">varchar</span>(<span class="dv">50</span>),</span>
<span id="cb93-8"><a href="sql.html#cb93-8"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb93-9"><a href="sql.html#cb93-9"></a>);</span>
<span id="cb93-10"><a href="sql.html#cb93-10"></a></span>
<span id="cb93-11"><a href="sql.html#cb93-11"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> diet_temp (</span>
<span id="cb93-12"><a href="sql.html#cb93-12"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb93-13"><a href="sql.html#cb93-13"></a>sample_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb93-14"><a href="sql.html#cb93-14"></a><span class="dt">date</span> text,</span>
<span id="cb93-15"><a href="sql.html#cb93-15"></a>item_id <span class="dt">integer</span>,</span>
<span id="cb93-16"><a href="sql.html#cb93-16"></a>item <span class="dt">varchar</span>(<span class="dv">50</span>)</span>
<span id="cb93-17"><a href="sql.html#cb93-17"></a>);</span></code></pre></div>
<p>Upload <code>diet.csv</code> into <code>diet_temp</code>.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb94-1"><a href="sql.html#cb94-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> diet(dragon_id, sample_id, <span class="dt">date</span>, item_id, item) </span>
<span id="cb94-2"><a href="sql.html#cb94-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> diet_temp;</span>
<span id="cb94-3"><a href="sql.html#cb94-3"></a></span>
<span id="cb94-4"><a href="sql.html#cb94-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> diet_temp;</span></code></pre></div>
<p>The deployments table assigns a tag to each individual within a certain period
of time. The <code>dragon_id</code> column will be the foreign key that links it to the
dragons table, and the <code>tag_id</code> column will link it to the tags table. The start
and end deployment dates will be stored as ISO8601 text. Again, we’ll need a
serial number to use as a primary key:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb95-1"><a href="sql.html#cb95-1"></a></span>
<span id="cb95-2"><a href="sql.html#cb95-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> deployments (</span>
<span id="cb95-3"><a href="sql.html#cb95-3"></a>deployment_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb95-4"><a href="sql.html#cb95-4"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb95-5"><a href="sql.html#cb95-5"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb95-6"><a href="sql.html#cb95-6"></a>start_deployment text,</span>
<span id="cb95-7"><a href="sql.html#cb95-7"></a>end_deployment text,</span>
<span id="cb95-8"><a href="sql.html#cb95-8"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb95-9"><a href="sql.html#cb95-9"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb95-10"><a href="sql.html#cb95-10"></a>);</span>
<span id="cb95-11"><a href="sql.html#cb95-11"></a></span>
<span id="cb95-12"><a href="sql.html#cb95-12"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> deployments_temp (</span>
<span id="cb95-13"><a href="sql.html#cb95-13"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb95-14"><a href="sql.html#cb95-14"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb95-15"><a href="sql.html#cb95-15"></a>start_deployment text,</span>
<span id="cb95-16"><a href="sql.html#cb95-16"></a>end_deployment text</span>
<span id="cb95-17"><a href="sql.html#cb95-17"></a>);</span></code></pre></div>
<p>Upload <code>deployments.csv</code> into <code>deployments_temp</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb96-1"><a href="sql.html#cb96-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> deployments(dragon_id, tag_id, start_deployment, end_deployment) </span>
<span id="cb96-2"><a href="sql.html#cb96-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> deployments_temp;</span>
<span id="cb96-3"><a href="sql.html#cb96-3"></a></span>
<span id="cb96-4"><a href="sql.html#cb96-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> deployments_temp;</span></code></pre></div>
<p>Now we can input the telemetry data. This table contains the raw tracking data
as we download it from the tags. We’ll need a serial number to uniquely identify
each record, and we’ll add the tag ID as the foreign key to the tags table:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb97-1"><a href="sql.html#cb97-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data_raw (</span>
<span id="cb97-2"><a href="sql.html#cb97-2"></a>gps_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> AUTOINCREMENT,</span>
<span id="cb97-3"><a href="sql.html#cb97-3"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb97-4"><a href="sql.html#cb97-4"></a><span class="dt">timestamp</span> text, </span>
<span id="cb97-5"><a href="sql.html#cb97-5"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb97-6"><a href="sql.html#cb97-6"></a>utm_y <span class="dt">double</span>,</span>
<span id="cb97-7"><a href="sql.html#cb97-7"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span>(tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb97-8"><a href="sql.html#cb97-8"></a>);</span>
<span id="cb97-9"><a href="sql.html#cb97-9"></a></span>
<span id="cb97-10"><a href="sql.html#cb97-10"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data_raw_temp (</span>
<span id="cb97-11"><a href="sql.html#cb97-11"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb97-12"><a href="sql.html#cb97-12"></a><span class="dt">timestamp</span> text, </span>
<span id="cb97-13"><a href="sql.html#cb97-13"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb97-14"><a href="sql.html#cb97-14"></a>utm_y <span class="dt">double</span></span>
<span id="cb97-15"><a href="sql.html#cb97-15"></a>);</span></code></pre></div>
<p>Upload <code>telemetry_raw.csv</code> into <code>gps_data_raw_temp</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb98-1"><a href="sql.html#cb98-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> gps_data_raw(tag_id, <span class="dt">timestamp</span>, utm_x, utm_y) </span>
<span id="cb98-2"><a href="sql.html#cb98-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gps_data_raw_temp;</span>
<span id="cb98-3"><a href="sql.html#cb98-3"></a></span>
<span id="cb98-4"><a href="sql.html#cb98-4"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> gps_data_raw_temp;</span></code></pre></div>
</div>
<div id="crossing-existing-information-to-derive-new-tables" class="section level3">
<h3><span class="header-section-number">6.3.8</span> Crossing existing information to derive new tables</h3>
<p>The raw GPS data table does not give us any information about which animal each
location corresponds to; all we know is the tag ID. Each tag does not correspond
to an individual, because some tags are reused on multiple dragons. So how do
we make these data usable? How do we know who is who? To associate each location
to the correct animal, we need to know who was wearing the tag at the time that
location was taken. There is a very elegant solution to our problem, as we can
pull the range of dates an individual was wearing a certain tag from the
deployments table, cross those dates with the dates in the raw GPS data, and
create an updated telemetry table where each location is assigned to the correct
individual. No manual work involved. Are you ready for some magic?! First, we
create the table structure:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb99-1"><a href="sql.html#cb99-1"></a></span>
<span id="cb99-2"><a href="sql.html#cb99-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gps_data (</span>
<span id="cb99-3"><a href="sql.html#cb99-3"></a>loc_id <span class="dt">INTEGER</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb99-4"><a href="sql.html#cb99-4"></a>tag_id <span class="dt">char</span>(<span class="dv">6</span>),</span>
<span id="cb99-5"><a href="sql.html#cb99-5"></a>dragon_id <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb99-6"><a href="sql.html#cb99-6"></a><span class="dt">timestamp</span> text,</span>
<span id="cb99-7"><a href="sql.html#cb99-7"></a>utm_x <span class="dt">double</span>,</span>
<span id="cb99-8"><a href="sql.html#cb99-8"></a>utm_y <span class="dt">double</span>,</span>
<span id="cb99-9"><a href="sql.html#cb99-9"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (tag_id) <span class="kw">REFERENCES</span> tags(tag_id)</span>
<span id="cb99-10"><a href="sql.html#cb99-10"></a><span class="kw">FOREIGN</span> <span class="kw">KEY</span> (dragon_id) <span class="kw">REFERENCES</span> dragons(dragon_id)</span>
<span id="cb99-11"><a href="sql.html#cb99-11"></a>);</span></code></pre></div>
<p>And then we populate it by pulling information from the raw GPS and deployment
tables. Locations are assigned to the individual that was wearing the tag at the
time based on the <code>WHERE</code> clause:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb100-1"><a href="sql.html#cb100-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> gps_data (</span>
<span id="cb100-2"><a href="sql.html#cb100-2"></a>tag_id, dragon_id, <span class="dt">timestamp</span>, utm_x, utm_y)</span>
<span id="cb100-3"><a href="sql.html#cb100-3"></a><span class="kw">SELECT</span></span>
<span id="cb100-4"><a href="sql.html#cb100-4"></a>deployments.tag_id,</span>
<span id="cb100-5"><a href="sql.html#cb100-5"></a>deployments.dragon_id,</span>
<span id="cb100-6"><a href="sql.html#cb100-6"></a>gps_data_raw.<span class="dt">timestamp</span>,</span>
<span id="cb100-7"><a href="sql.html#cb100-7"></a>gps_data_raw.utm_x,</span>
<span id="cb100-8"><a href="sql.html#cb100-8"></a>gps_data_raw.utm_y</span>
<span id="cb100-9"><a href="sql.html#cb100-9"></a><span class="kw">FROM</span> deployments <span class="kw">LEFT</span> <span class="kw">JOIN</span> gps_data_raw <span class="kw">USING</span> (tag_id)</span>
<span id="cb100-10"><a href="sql.html#cb100-10"></a><span class="kw">WHERE</span> gps_data_raw.tag_id <span class="op">=</span> deployments.tag_id <span class="kw">AND</span></span>
<span id="cb100-11"><a href="sql.html#cb100-11"></a>(</span>
<span id="cb100-12"><a href="sql.html#cb100-12"></a>    (</span>
<span id="cb100-13"><a href="sql.html#cb100-13"></a>    (strftime(gps_data_raw.<span class="dt">timestamp</span>) <span class="op">&gt;=</span> strftime(deployments.start_deployment)) <span class="kw">AND</span></span>
<span id="cb100-14"><a href="sql.html#cb100-14"></a>    (strftime(gps_data_raw.<span class="dt">timestamp</span>) <span class="op">&lt;=</span> strftime(deployments.end_deployment))</span>
<span id="cb100-15"><a href="sql.html#cb100-15"></a>    )</span>
<span id="cb100-16"><a href="sql.html#cb100-16"></a><span class="kw">OR</span> </span>
<span id="cb100-17"><a href="sql.html#cb100-17"></a>    (</span>
<span id="cb100-18"><a href="sql.html#cb100-18"></a>    (gps_data_raw.<span class="dt">timestamp</span> <span class="op">&gt;=</span> deployments.start_deployment) <span class="kw">AND</span></span>
<span id="cb100-19"><a href="sql.html#cb100-19"></a>    (deployments.end_deployment <span class="kw">IS</span> <span class="kw">NULL</span>)</span>
<span id="cb100-20"><a href="sql.html#cb100-20"></a>    )</span>
<span id="cb100-21"><a href="sql.html#cb100-21"></a>);</span></code></pre></div>
<p>Note that, because we populated this table with data from other existing tables,
we ended up using <code>INSERT INTO</code> anyway and there was no need to use our trick
with a temporary table.</p>
<p>It should now be apparent that keeping the deployments table correctly filled
out with no gaps or errors is of vital importance for the integrity of the whole
telemetry database. Having the database set up this way means we never have to
manually assign locations to animals, which would for sure lead to errors, but
it also means that any analysis downstream hinges on keeping the deployments
table up-to-date with new captures, tag retrievals, and deaths. This is just one
example of how databases can save us time and ensure data integrity with minimal
routine effort, but only if the data is curated with care in the first place.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="relational-databases.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rsqlite.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["reproducible-science.pdf", "reproducible-science.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
